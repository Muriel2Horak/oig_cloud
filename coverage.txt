============================= test session starts ==============================
platform darwin -- Python 3.13.4, pytest-8.4.2, pluggy-1.6.0 -- /Users/martinhorak/Downloads/oig_cloud/venv/bin/python3.13
cachedir: .pytest_cache
rootdir: /Users/martinhorak/Downloads/oig_cloud
configfile: pytest.ini
plugins: respx-0.22.0, pytest_freezer-0.4.9, unordered-0.7.0, asyncio-1.2.0, anyio-4.11.0, sugar-1.0.0, socket-0.7.0, xdist-3.8.0, timeout-2.4.0, homeassistant-custom-component-0.13.295, github-actions-annotate-failures-0.3.0, aiohttp-1.1.0, picked-0.5.1, requests-mock-1.12.1, cov-7.0.0, syrupy-5.0.0
asyncio: mode=Mode.AUTO, debug=False, asyncio_default_fixture_loop_scope=function, asyncio_default_test_loop_scope=function
collecting ... collected 1889 items

tests/test_adaptive_consumption.py::test_format_profile_description_strips_similarity PASSED [  0%]
tests/test_adaptive_consumption.py::test_format_profile_description_empty PASSED [  0%]
tests/test_adaptive_consumption.py::test_calculate_consumption_summary_list_and_dict PASSED [  0%]
tests/test_adaptive_consumption.py::test_process_adaptive_consumption_for_dashboard PASSED [  0%]
tests/test_adaptive_consumption.py::test_select_tomorrow_profile_transition PASSED [  0%]
tests/test_adaptive_consumption.py::test_select_tomorrow_profile_standard PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_normalize_profile_name_empty PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_normalize_profile_name_fallback PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_build_profile_suffix_invalid_values PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_build_dashboard_profile_details_no_score PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_calculate_charging_cost_today_invalid_rows PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_season_and_transition_helpers PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_select_profile_by_prefix PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_process_adaptive_consumption_invalid_profiles PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_calculate_consumption_summary_invalid_type PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_get_adaptive_load_prediction_variants PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_get_profiles_from_sensor_variants PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_get_today_hourly_consumption_variants PASSED [  0%]
tests/test_adaptive_consumption_more.py::test_calculate_recent_consumption_ratio_variants PASSED [  1%]
tests/test_adaptive_consumption_more.py::test_apply_consumption_boost_and_similarity PASSED [  1%]
tests/test_adaptive_consumption_more.py::test_select_tomorrow_profile_error PASSED [  1%]
tests/test_adaptive_consumption_more.py::test_get_consumption_today_variants PASSED [  1%]
tests/test_adaptive_consumption_more.py::test_get_load_avg_fallback_variants PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_get_season PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_generate_profile_name_variants PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_fill_missing_values PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_build_daily_profiles_and_72h PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_build_current_match PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_apply_floor_to_prediction PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_calculate_profile_similarity PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_extra_state_attributes_prediction PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_async_added_and_removed_starts_task PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_profiling_loop_cancel PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_wait_for_next_profile_window PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_create_and_update_profile_success PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_create_and_update_profile_warming_up PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_get_energy_unit_factor PASSED [  1%]
tests/test_adaptive_load_profiles_sensor_more.py::test_load_hourly_series_and_earliest_start PASSED [  2%]
tests/test_adaptive_load_profiles_sensor_more.py::test_find_best_matching_profile_paths PASSED [  2%]
tests/test_adaptive_load_profiles_sensor_more.py::test_find_best_matching_profile_fallback PASSED [  2%]
tests/test_api_chmu.py::test_cache_validation_and_invalidate PASSED      [  2%]
tests/test_api_chmu.py::test_parse_polygon_and_circle PASSED             [  2%]
tests/test_api_chmu.py::test_geometry_helpers PASSED                     [  2%]
tests/test_api_chmu.py::test_parse_cap_xml_minimal PASSED                [  2%]
tests/test_api_chmu.py::test_filter_select_and_prefer_language PASSED    [  2%]
tests/test_api_chmu_more.py::test_fetch_cap_xml_http_errors PASSED       [  2%]
tests/test_api_chmu_more.py::test_fetch_cap_xml_success PASSED           [  2%]
tests/test_api_chmu_more.py::test_fetch_cap_xml_timeout_and_client_error PASSED [  2%]
tests/test_api_chmu_more.py::test_resolve_latest_cap_url_variants PASSED [  2%]
tests/test_api_chmu_more.py::test_parse_cap_xml_error_and_info_exception PASSED [  2%]
tests/test_api_chmu_more.py::test_parse_info_block_language_event_and_awareness PASSED [  2%]
tests/test_api_chmu_more.py::test_get_text_with_xpath_default PASSED     [  2%]
tests/test_api_chmu_more.py::test_determine_status_and_eta_and_parse_iso PASSED [  2%]
tests/test_api_chmu_more.py::test_filter_by_location_geocode_fallback PASSED [  2%]
tests/test_api_chmu_more.py::test_select_top_alert_and_prefer_language_empty PASSED [  2%]
tests/test_api_chmu_more.py::test_get_warnings_cache_and_session_close PASSED [  2%]
tests/test_api_chmu_more.py::test_parse_circle_invalid_value PASSED      [  3%]
tests/test_balancing_core_additional.py::test_async_setup_and_load_errors PASSED [  3%]
tests/test_balancing_core_additional.py::test_get_cooldown_hours_invalid_config PASSED [  3%]
tests/test_balancing_core_additional.py::test_set_coordinator PASSED     [  3%]
tests/test_balancing_core_additional.py::test_async_setup_success PASSED [  3%]
tests/test_balancing_core_additional.py::test_save_state_coordinator_error PASSED [  3%]
tests/test_balancing_core_additional.py::test_save_state_coordinator_success PASSED [  3%]
tests/test_balancing_core_additional.py::test_load_state_with_data PASSED [  3%]
tests/test_balancing_core_additional.py::test_get_cheap_window_percentile_exception PASSED [  3%]
tests/test_balancing_core_additional.py::test_load_state_safe_error PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_no_forecast_sensor PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_detects_completion PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_active_plan_paths PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_active_plan_future_deadline PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_cycle_forced PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_force_and_natural PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_balancing_opportunistic PASSED [  3%]
tests/test_balancing_core_additional.py::test_force_plan_failure PASSED  [  3%]
tests/test_balancing_core_additional.py::test_get_days_and_hours_since_last PASSED [  3%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_stats_paths PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_varied_starts PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_recent_and_invalid_type PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_runtime_error PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_runtime_error_other PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_exception PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_if_balancing_occurred_no_stats PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_natural_balancing_paths PASSED [  4%]
tests/test_balancing_core_additional.py::test_check_natural_balancing_resets_window PASSED [  4%]
tests/test_balancing_core_additional.py::test_create_opportunistic_plan_paths PASSED [  4%]
tests/test_balancing_core_additional.py::test_create_opportunistic_plan_with_prices_immediate PASSED [  4%]
tests/test_balancing_core_additional.py::test_create_opportunistic_plan_with_prices_delayed PASSED [  4%]
tests/test_balancing_core_additional.py::test_create_opportunistic_plan_skips_past_and_expensive PASSED [  4%]
tests/test_balancing_core_additional.py::test_create_forced_plan PASSED  [  4%]
tests/test_balancing_core_additional.py::test_plan_helpers PASSED        [  4%]
tests/test_balancing_core_additional.py::test_cost_helpers PASSED        [  4%]
tests/test_balancing_core_additional.py::test_calculate_immediate_cost_missing_price PASSED [  4%]
tests/test_balancing_core_additional.py::test_calculate_immediate_cost_missing_capacity PASSED [  4%]
tests/test_balancing_core_additional.py::test_calculate_total_cost_missing_capacity PASSED [  4%]
tests/test_balancing_core_additional.py::test_calculate_total_cost_timeline_branches PASSED [  5%]
tests/test_balancing_core_additional.py::test_cost_helpers_no_prices PASSED [  5%]
tests/test_balancing_core_additional.py::test_find_cheap_holding_window_no_prices PASSED [  5%]
tests/test_balancing_core_additional.py::test_find_cheap_holding_window_insufficient_intervals PASSED [  5%]
tests/test_balancing_core_additional.py::test_find_cheap_holding_window PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_hybrid_timeline_no_sensor PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_current_soc_percent_invalid PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_battery_capacity_conversions PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_battery_capacity_invalid PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_spot_prices_no_forecast_sensor PASSED [  5%]
tests/test_balancing_core_additional.py::test_sensor_state_and_attributes PASSED [  5%]
tests/test_balancing_core_additional.py::test_get_active_plan_and_sensor_states PASSED [  5%]
tests/test_balancing_core_extra.py::test_config_helpers_default_and_overrides PASSED [  5%]
tests/test_balancing_core_extra.py::test_plan_ups_charging_and_holding_intervals PASSED [  5%]
tests/test_balancing_core_extra.py::test_get_battery_capacity_kwh_handles_units PASSED [  5%]
tests/test_balancing_core_extra.py::test_get_spot_prices_48h_parses_timeline PASSED [  5%]
tests/test_balancing_core_extra.py::test_calculate_immediate_balancing_cost PASSED [  5%]
tests/test_balancing_core_extra.py::test_calculate_total_balancing_cost PASSED [  5%]
tests/test_balancing_core_extra.py::test_find_cheap_holding_window PASSED [  5%]
tests/test_balancing_core_extra.py::test_get_current_soc_percent_and_sensor_state PASSED [  6%]
tests/test_balancing_core_more.py::test_days_and_hours_since_last_balancing PASSED [  6%]
tests/test_balancing_core_more.py::test_check_if_balancing_occurred_detects_completion PASSED [  6%]
tests/test_balancing_core_more.py::test_check_natural_balancing_creates_plan PASSED [  6%]
tests/test_balancing_core_more.py::test_get_battery_capacity_kwh_wh_units PASSED [  6%]
tests/test_balancing_core_more.py::test_get_spot_prices_48h PASSED       [  6%]
tests/test_balancing_core_more.py::test_find_cheap_holding_window PASSED [  6%]
tests/test_balancing_executor_more.py::test_parse_plan_missing_fields PASSED [  6%]
tests/test_balancing_executor_more.py::test_parse_plan_preferred_intervals_variants PASSED [  6%]
tests/test_balancing_executor_more.py::test_apply_balancing_infeasible_warning PASSED [  6%]
tests/test_balancing_executor_more.py::test_get_balancing_indices_and_costs PASSED [  6%]
tests/test_balancing_helpers.py::test_update_balancing_plan_snapshot_sets_active PASSED [  6%]
tests/test_balancing_helpers.py::test_update_balancing_plan_snapshot_clears_on_balancing PASSED [  6%]
tests/test_balancing_helpers.py::test_get_balancing_plan PASSED          [  6%]
tests/test_balancing_helpers.py::test_get_balancing_plan_no_hass PASSED  [  6%]
tests/test_balancing_helpers.py::test_get_balancing_plan_no_state PASSED [  6%]
tests/test_balancing_helpers.py::test_get_balancing_plan_no_planned PASSED [  6%]
tests/test_balancing_helpers.py::test_get_balancing_plan_empty_planned PASSED [  6%]
tests/test_balancing_helpers.py::test_update_balancing_plan_snapshot_empty_requester PASSED [  6%]
tests/test_balancing_helpers.py::test_plan_balancing_success PASSED      [  7%]
tests/test_balancing_helpers.py::test_plan_balancing_error PASSED        [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_requires_forecast_sensor PASSED [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_active_plan_holding PASSED [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_force_creates_plan PASSED [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_natural_plan PASSED [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_forced_by_cycle PASSED [  7%]
tests/test_balancing_manager_core.py::test_check_balancing_opportunistic PASSED [  7%]
tests/test_balancing_manager_core.py::test_balancing_config_helpers PASSED [  7%]
tests/test_balancing_manager_core.py::test_load_and_save_state PASSED    [  7%]
tests/test_balancing_manager_core.py::test_get_sensor_state_and_attributes PASSED [  7%]
tests/test_balancing_simulation.py::TestBalancingSimulation::test_interval_balancing_7th_day PASSED [  7%]
tests/test_balancing_simulation.py::TestBalancingSimulation::test_opportunistic_balancing PASSED [  7%]
tests/test_balancing_simulation.py::TestBalancingSimulation::test_normal_operation_no_balancing PASSED [  7%]
tests/test_balancing_simulation.py::TestBalancingSimulation::test_compare_balancing_vs_normal PASSED [  7%]
tests/test_balancing_simulation.py::TestBalancingSimulation::test_balancing_deadline_reached PASSED [  7%]
tests/test_battery_efficiency_sensor.py::test_daily_update_computes_partial_efficiency PASSED [  7%]
tests/test_battery_efficiency_sensor.py::test_monthly_calculation_sets_last_month PASSED [  7%]
tests/test_battery_efficiency_sensor.py::test_daily_update_without_month_start PASSED [  7%]
tests/test_battery_efficiency_sensor.py::test_monthly_calculation_insufficient_data PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_monthly_calculation_invalid_effective PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_monthly_calculation_invalid_effective_discharge PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_update_extra_state_attributes_triggers_history PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_get_sensor_handles_missing PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_init_resolve_box_id_error PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_import_error PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_success PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_invalid_data PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_bad_values PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_error PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_async_added_to_hass_restores_state PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_async_added_to_hass_invalid_state PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_async_added_to_hass_initializes_mid_month PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_update_extra_state_attributes_without_efficiency PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_async_added_to_hass_no_last_state_beginning_month PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_async_will_remove_from_hass PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_monthly_calculation_wrong_day PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_get_sensor_invalid_state PASSED [  8%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_no_history PASSED [  9%]
tests/test_battery_efficiency_sensor.py::test_try_load_last_month_from_history_incomplete PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_async_added_and_removed PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_create_mode_recommendations PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_update_balancing_plan_snapshot PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_group_intervals_by_mode PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_build_strategy_balancing_plan_branches PASSED [  9%]
tests/test_battery_forecast_ha_sensor_more.py::test_build_strategy_balancing_plan_legacy PASSED [  9%]
tests/test_battery_forecast_module.py::test_types_import PASSED          [  9%]
tests/test_battery_forecast_module.py::test_simulator_basic PASSED       [  9%]
tests/test_battery_forecast_module.py::test_simulator_timeline PASSED    [  9%]
tests/test_battery_forecast_module.py::test_mode_selector PASSED         [  9%]
tests/test_battery_forecast_module.py::test_hybrid_optimizer_basic PASSED [  9%]
tests/test_battery_forecast_module.py::test_balancing_executor PASSED    [  9%]
tests/test_battery_forecast_module.py::test_timeline_builder PASSED      [  9%]
tests/test_battery_forecast_module.py::test_strategy_to_timeline PASSED  [  9%]
tests/test_battery_state_helpers.py::test_get_total_battery_capacity_installed PASSED [  9%]
tests/test_battery_state_helpers.py::test_get_total_battery_capacity_pv_data PASSED [  9%]
tests/test_battery_state_helpers.py::test_get_current_battery_capacity PASSED [ 10%]
tests/test_battery_state_helpers.py::test_total_capacity_fallbacks PASSED [ 10%]
tests/test_battery_state_helpers.py::test_read_state_float_branches PASSED [ 10%]
tests/test_battery_state_helpers.py::test_capacity_from_pv_data_error PASSED [ 10%]
tests/test_battery_state_helpers.py::test_current_soc_percent PASSED     [ 10%]
tests/test_battery_state_helpers.py::test_min_target_capacity PASSED     [ 10%]
tests/test_battery_state_helpers.py::test_current_capacity_missing PASSED [ 10%]
tests/test_battery_state_helpers.py::test_get_max_capacity PASSED        [ 10%]
tests/test_battery_state_helpers.py::test_battery_efficiency PASSED      [ 10%]
tests/test_battery_state_helpers.py::test_ac_charging_limit PASSED       [ 10%]
tests/test_battery_state_helpers.py::test_get_current_mode PASSED        [ 10%]
tests/test_battery_state_helpers.py::test_get_boiler_available_capacity PASSED [ 10%]
tests/test_binary_sensor.py::test_binary_sensor_types_present PASSED     [ 10%]
tests/test_binary_sensor.py::test_binary_sensor_basic PASSED             [ 10%]
tests/test_binary_sensor.py::test_async_setup_entry_creates_entities PASSED [ 10%]
tests/test_boiler_module.py::test_boiler_utils_stratified_temp_simple_avg PASSED [ 10%]
tests/test_boiler_module.py::test_boiler_utils_stratified_temp_two_zone PASSED [ 10%]
tests/test_boiler_module.py::test_boiler_utils_energy_and_residual PASSED [ 10%]
tests/test_boiler_module.py::test_boiler_utils_validate_temperature_sensor PASSED [ 10%]
tests/test_boiler_module.py::test_boiler_models_profile_and_plan PASSED  [ 11%]
tests/test_boiler_module.py::test_boiler_profiler_update_profiles PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_profiler_get_profile_for_datetime_low_confidence PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_profiler_fetch_history_handles_instance PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_planner_spot_price_and_recommendations PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_planner_create_plan_and_overflow_windows PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_coordinator_helpers PASSED      [ 11%]
tests/test_boiler_module.py::test_boiler_coordinator_spot_prices_and_overflow PASSED [ 11%]
tests/test_boiler_module.py::test_boiler_sensors_and_api_views PASSED    [ 11%]
tests/test_config_flow_entry.py::test_step_user_form PASSED              [ 11%]
tests/test_config_flow_entry.py::test_step_user_quick_setup PASSED       [ 11%]
tests/test_config_flow_entry.py::test_step_user_wizard PASSED            [ 11%]
tests/test_config_flow_entry.py::test_quick_setup_requires_live_data PASSED [ 11%]
tests/test_config_flow_entry.py::test_quick_setup_success PASSED         [ 11%]
tests/test_config_flow_entry.py::test_import_yaml_not_implemented PASSED [ 11%]
tests/test_config_flow_entry.py::test_wizard_summary_creates_entry PASSED [ 11%]
tests/test_config_flow_module.py::test_config_flow_exports PASSED        [ 11%]
tests/test_config_flow_quick_setup.py::test_async_step_user_routes PASSED [ 11%]
tests/test_config_flow_quick_setup.py::test_quick_setup_live_data_required PASSED [ 11%]
tests/test_config_flow_quick_setup.py::test_quick_setup_validate_input_error PASSED [ 12%]
tests/test_config_flow_quick_setup.py::test_quick_setup_success PASSED   [ 12%]
tests/test_config_flow_wizard_steps.py::test_get_total_steps_with_modules PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_get_total_steps_options_flow PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_get_step_placeholders_progress PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_get_next_step_skips_disabled PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_wizard_modules_requires_dependencies PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_wizard_modules_dashboard_requires_all PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_wizard_intervals_validation_errors PASSED [ 12%]
tests/test_config_flow_wizard_steps.py::test_wizard_credentials_back_button PASSED [ 12%]
tests/test_config_helpers.py::test_sanitize_data_source_mode PASSED      [ 12%]
tests/test_config_helpers.py::test_migrate_old_pricing_data_percentage PASSED [ 12%]
tests/test_config_helpers.py::test_map_pricing_to_backend_fixed_price PASSED [ 12%]
tests/test_config_helpers.py::test_validate_tariff_hours PASSED          [ 12%]
tests/test_config_helpers.py::test_validate_input_ok PASSED              [ 12%]
tests/test_config_helpers.py::test_validate_input_live_data_missing PASSED [ 12%]
tests/test_config_helpers.py::test_validate_solar_forecast_api_key_status PASSED [ 12%]
tests/test_config_options_flow.py::test_options_flow_welcome_reconfigure PASSED [ 12%]
tests/test_config_options_flow.py::test_options_flow_summary_updates_entry PASSED [ 12%]
tests/test_config_options_flow.py::test_options_flow_summary_form PASSED [ 13%]
tests/test_config_options_flow.py::test_options_flow_summary_exception PASSED [ 13%]
tests/test_config_options_flow.py::test_options_flow_summary_flags PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_get_defaults_migrates_legacy_pricing PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_pricing_distribution_schema_defaults_weekend_same PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_wizard_boiler_back_button_uses_history PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_wizard_boiler_form_and_submit PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_migrate_old_pricing_data_percentage_dual PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_migrate_old_pricing_data_fixed_single PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_migrate_old_pricing_data_fixed_prices_dual PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_migrate_old_pricing_data_noop_for_new PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_map_pricing_to_backend_spot_fixed_and_percentage_export PASSED [ 13%]
tests/test_config_steps_boiler_and_migration.py::test_map_pricing_to_backend_fix_price_import_and_export PASSED [ 13%]
tests/test_config_steps_distribution.py::test_pricing_distribution_schema_weekend_fields PASSED [ 13%]
tests/test_config_steps_distribution.py::test_pricing_distribution_weekend_toggle_rerender PASSED [ 13%]
tests/test_config_steps_distribution.py::test_pricing_distribution_invalid_hours PASSED [ 13%]
tests/test_config_steps_distribution.py::test_pricing_distribution_success_weekend_custom PASSED [ 13%]
tests/test_config_steps_flow.py::test_total_steps_with_modules_and_summary PASSED [ 13%]
tests/test_config_steps_flow.py::test_total_steps_options_flow_reconfigure PASSED [ 13%]
tests/test_config_steps_flow.py::test_current_step_number_pricing_flow PASSED [ 14%]
tests/test_config_steps_flow.py::test_step_placeholders_progress_bar PASSED [ 14%]
tests/test_config_steps_flow.py::test_get_next_step_skips_disabled_modules PASSED [ 14%]
tests/test_config_steps_flow.py::test_wizard_intervals_validation_errors PASSED [ 14%]
tests/test_config_steps_flow.py::test_wizard_intervals_success_path PASSED [ 14%]
tests/test_config_steps_helpers_more.py::test_sanitize_data_source_mode PASSED [ 14%]
tests/test_config_steps_helpers_more.py::test_migrate_old_pricing_data_fixed_prices_dual PASSED [ 14%]
tests/test_config_steps_helpers_more.py::test_map_pricing_to_backend_dual_weekend_custom PASSED [ 14%]
tests/test_config_steps_helpers_more.py::test_map_backend_to_frontend_fixed_prices_dual PASSED [ 14%]
tests/test_config_steps_helpers_more2.py::test_handle_back_button_history PASSED [ 14%]
tests/test_config_steps_helpers_more2.py::test_generate_summary_variants PASSED [ 14%]
tests/test_config_steps_more.py::test_migrate_old_pricing_data_empty_and_passthrough PASSED [ 14%]
tests/test_config_steps_more.py::test_migrate_old_pricing_data_fixed_models PASSED [ 14%]
tests/test_config_steps_more.py::test_map_backend_to_frontend_weekend_same_defaults PASSED [ 14%]
tests/test_config_steps_more.py::test_get_defaults_reconfiguration PASSED [ 14%]
tests/test_config_steps_more.py::test_handle_back_button_returns_previous PASSED [ 14%]
tests/test_config_steps_more.py::test_handle_back_button_no_history_returns_welcome PASSED [ 14%]
tests/test_config_steps_more.py::test_generate_summary_all_sections PASSED [ 14%]
tests/test_config_steps_more3.py::test_sanitize_data_source_mode_variants PASSED [ 14%]
tests/test_config_steps_more3.py::test_config_flow_sanitize_mode_override PASSED [ 15%]
tests/test_config_steps_more3.py::test_pricing_distribution_tariff_change_rerender PASSED [ 15%]
tests/test_config_steps_more3.py::test_pricing_distribution_invalid_fees_and_vat PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_intervals_local_proxy_missing PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_solar_validation_errors PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_solar_string_param_errors PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_solar_initial_form PASSED  [ 15%]
tests/test_config_steps_more4.py::test_wizard_welcome_routes PASSED      [ 15%]
tests/test_config_steps_more4.py::test_wizard_credentials_live_data_not_enabled PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_credentials_invalid_auth PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_credentials_cannot_connect PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_credentials_unknown_error PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_credentials_initial_form PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_modules_go_back PASSED     [ 15%]
tests/test_config_steps_more4.py::test_wizard_modules_dashboard_requires_all PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_solar_invalid_coordinates_format PASSED [ 15%]
tests/test_config_steps_more4.py::test_wizard_solar_invalid_string_params_format PASSED [ 15%]
tests/test_config_steps_more4.py::test_migrate_old_pricing_data_fixed_dual PASSED [ 15%]
tests/test_config_steps_more4.py::test_map_backend_to_frontend_weekend_same_inferred PASSED [ 15%]
tests/test_config_steps_more4.py::test_map_backend_to_frontend_weekend_same_computed_false PASSED [ 16%]
tests/test_config_steps_more4.py::test_get_defaults_non_reconfiguration PASSED [ 16%]
tests/test_config_steps_more4.py::test_get_planner_mode_value PASSED     [ 16%]
tests/test_config_steps_more4.py::test_get_step_placeholders_fallback PASSED [ 16%]
tests/test_config_steps_more4.py::test_get_current_step_number_options_flow PASSED [ 16%]
tests/test_config_steps_more4.py::test_get_next_step_unknown PASSED      [ 16%]
tests/test_config_steps_more4.py::test_quick_setup_ote_api_warning PASSED [ 16%]
tests/test_config_steps_more4.py::test_quick_setup_live_data_not_enabled PASSED [ 16%]
tests/test_config_steps_more4.py::test_quick_setup_invalid_auth PASSED   [ 16%]
tests/test_config_steps_more4.py::test_quick_setup_unknown_error PASSED  [ 16%]
tests/test_config_steps_pricing.py::test_sanitize_data_source_mode PASSED [ 16%]
tests/test_config_steps_pricing.py::test_migrate_old_pricing_data_percentage_dual PASSED [ 16%]
tests/test_config_steps_pricing.py::test_migrate_old_pricing_data_fixed_prices_single PASSED [ 16%]
tests/test_config_steps_pricing.py::test_map_pricing_to_backend PASSED   [ 16%]
tests/test_config_steps_pricing.py::test_map_backend_to_frontend PASSED  [ 16%]
tests/test_config_steps_pricing.py::test_pricing_import_scenario_switch PASSED [ 16%]
tests/test_config_steps_pricing.py::test_pricing_import_invalid_fee PASSED [ 16%]
tests/test_config_steps_pricing.py::test_pricing_export_invalid_price PASSED [ 16%]
tests/test_config_steps_pricing.py::test_pricing_import_success PASSED   [ 16%]
tests/test_config_steps_wizard_extra.py::test_wizard_credentials_missing_fields PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_credentials_go_back PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_credentials_validate_errors PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_credentials_success PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_modules_requires_solar_and_extended PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_modules_dashboard_requires_modules PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_modules_success_moves_forward PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_solar_toggle_expands_form PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_solar_validation_errors PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_solar_success PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_battery_validation_errors PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_battery_success PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_pricing_import_scenario_change PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_pricing_import_validation_error PASSED [ 17%]
tests/test_config_steps_wizard_extra.py::test_wizard_pricing_distribution_validation PASSED [ 17%]
tests/test_config_validation.py::test_validate_input_invalid_auth PASSED [ 17%]
tests/test_config_validation.py::test_validate_input_live_data_missing PASSED [ 17%]
tests/test_config_validation.py::test_validate_input_success PASSED      [ 17%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_ok PASSED [ 17%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_unauthorized PASSED [ 18%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_rate_limited PASSED [ 18%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_other_error PASSED [ 18%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_empty PASSED [ 18%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_client_error PASSED [ 18%]
tests/test_config_validation.py::test_validate_solar_forecast_api_key_timeout PASSED [ 18%]
tests/test_coordinator.py::test_coordinator_init_pricing_enables_ote PASSED [ 18%]
tests/test_coordinator.py::test_coordinator_init_chmu_enabled PASSED     [ 18%]
tests/test_coordinator.py::test_coordinator_initialization PASSED        [ 18%]
tests/test_coordinator.py::test_async_update_data_success PASSED         [ 18%]
tests/test_coordinator.py::test_async_update_data_empty_response PASSED  [ 18%]
tests/test_coordinator.py::test_async_update_data_api_error PASSED       [ 18%]
tests/test_coordinator.py::test_async_update_data_jitter_positive PASSED [ 18%]
tests/test_coordinator.py::test_async_update_data_data_source_state_exception PASSED [ 18%]
tests/test_coordinator.py::test_async_update_data_telemetry_snapshot_exception PASSED [ 18%]
tests/test_coordinator.py::test_async_update_data_local_mode_no_telemetry_store PASSED [ 18%]
tests/test_coordinator.py::test_async_update_data_fill_config_nodes_exception PASSED [ 18%]
tests/test_coordinator.py::test_extended_data_enabled PASSED             [ 18%]
tests/test_coordinator.py::test_async_update_data_startup_grace_includes_cache PASSED [ 19%]
tests/test_coordinator.py::test_async_update_data_initial_spot_fetch PASSED [ 19%]
tests/test_coordinator.py::test_schedule_spot_price_update_before_13 PASSED [ 19%]
tests/test_coordinator.py::test_schedule_spot_price_update_after_13 PASSED [ 19%]
tests/test_coordinator.py::test_schedule_spot_price_update_callback PASSED [ 19%]
tests/test_coordinator.py::test_schedule_hourly_fallback_schedules PASSED [ 19%]
tests/test_coordinator.py::test_hourly_fallback_updates_cache PASSED     [ 19%]
tests/test_coordinator.py::test_hourly_fallback_no_data_and_exception PASSED [ 19%]
tests/test_coordinator.py::test_hourly_fallback_no_need PASSED           [ 19%]
tests/test_coordinator.py::test_hourly_fallback_no_ote_api PASSED        [ 19%]
tests/test_coordinator.py::test_hourly_fallback_after_13_missing_tomorrow PASSED [ 19%]
tests/test_coordinator.py::test_hourly_fallback_warning_on_empty PASSED  [ 19%]
tests/test_coordinator.py::test_update_spot_prices_success PASSED        [ 19%]
tests/test_coordinator.py::test_update_spot_prices_updates_listeners PASSED [ 19%]
tests/test_coordinator.py::test_update_spot_prices_no_ote_api PASSED     [ 19%]
tests/test_coordinator.py::test_update_spot_prices_exception_calls_retry PASSED [ 19%]
tests/test_coordinator.py::test_update_spot_prices_failure_calls_retry PASSED [ 19%]
tests/test_coordinator.py::test_handle_spot_retry_outside_important PASSED [ 19%]
tests/test_coordinator.py::test_handle_spot_retry_inside_important PASSED [ 19%]
tests/test_coordinator.py::test_handle_spot_retry_cancels_existing PASSED [ 20%]
tests/test_coordinator.py::test_handle_spot_retry_resets_after_max PASSED [ 20%]
tests/test_coordinator.py::test_handle_spot_retry_executes_retry_callback PASSED [ 20%]
tests/test_coordinator.py::test_prune_for_cache_limits_payload PASSED    [ 20%]
tests/test_coordinator.py::test_prune_for_cache_fallback_str_failure PASSED [ 20%]
tests/test_coordinator.py::test_prune_for_cache_depth_limit PASSED       [ 20%]
tests/test_coordinator.py::test_prune_for_cache_datetime_isoformat_error PASSED [ 20%]
tests/test_coordinator.py::test_maybe_schedule_cache_save PASSED         [ 20%]
tests/test_coordinator.py::test_maybe_schedule_cache_save_no_store PASSED [ 20%]
tests/test_coordinator.py::test_maybe_schedule_cache_save_errors PASSED  [ 20%]
tests/test_coordinator.py::test_maybe_schedule_cache_save_async_save_error PASSED [ 20%]
tests/test_coordinator.py::test_update_intervals_triggers_refresh PASSED [ 20%]
tests/test_coordinator.py::test_fill_config_nodes_from_cloud PASSED      [ 20%]
tests/test_coordinator.py::test_fill_config_nodes_from_cloud_missing_box PASSED [ 20%]
tests/test_coordinator.py::test_should_update_extended_handles_timezone PASSED [ 20%]
tests/test_coordinator.py::test_async_update_data_local_mode_uses_snapshot PASSED [ 20%]
tests/test_coordinator.py::test_async_update_data_standalone_notifications PASSED [ 20%]
tests/test_coordinator.py::test_async_update_data_notification_init_failure PASSED [ 20%]
tests/test_coordinator.py::test_async_update_data_notification_init_success PASSED [ 20%]
tests/test_coordinator.py::test_async_update_data_notification_status_no_attr PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_config_entry_options_exception PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_no_config_entry PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_extended_notifications_success PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_extended_notifications_no_device PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_extended_notifications_failure PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_extended_stats_failure PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_standalone_notification_failure PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_battery_forecast_task_running PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_includes_spot_prices_cache PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_includes_battery_forecast_data PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_initial_spot_fetch_empty PASSED [ 21%]
tests/test_coordinator.py::test_async_update_data_initial_spot_fetch_exception PASSED [ 21%]
tests/test_coordinator.py::test_update_battery_forecast_skips_without_data PASSED [ 21%]
tests/test_coordinator.py::test_update_battery_forecast_no_inverter PASSED [ 21%]
tests/test_coordinator.py::test_update_battery_forecast_with_timeline PASSED [ 21%]
tests/test_coordinator.py::test_update_battery_forecast_no_timeline PASSED [ 21%]
tests/test_coordinator.py::test_create_simple_battery_forecast_no_data PASSED [ 21%]
tests/test_coordinator.py::test_create_simple_battery_forecast_with_data PASSED [ 21%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_throttled PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_option_error PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_stats_keys_error PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_box_not_dict PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_no_missing_nodes PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_cloud_fetch_error PASSED [ 22%]
tests/test_coordinator.py::test_maybe_fill_config_nodes_cloud_invalid PASSED [ 22%]
tests/test_coordinator.py::test_should_update_extended_naive_last_update PASSED [ 22%]
tests/test_coordinator.py::test_update_battery_forecast_config_entry_options_error PASSED [ 22%]
tests/test_coordinator.py::test_update_battery_forecast_exception PASSED [ 22%]
tests/test_coordinator.py::test_utcnow_fallback PASSED                   [ 22%]
tests/test_coordinator.py::test_init_pricing_cache_load_error_next_day PASSED [ 22%]
tests/test_coordinator.py::test_init_pricing_ote_api_error PASSED        [ 22%]
tests/test_coordinator.py::test_init_chmu_api_error PASSED               [ 22%]
tests/test_coordinator.py::test_async_config_entry_first_refresh_cache_load PASSED [ 22%]
tests/test_coordinator.py::test_async_config_entry_first_refresh_cache_load_error PASSED [ 22%]
tests/test_coordinator.py::test_async_config_entry_first_refresh_failure_with_cache PASSED [ 22%]
tests/test_coordinator.py::test_async_config_entry_first_refresh_failure_no_cache PASSED [ 22%]
tests/test_data_sensor_extra.py::test_notification_state_and_attributes PASSED [ 22%]
tests/test_data_sensor_extra.py::test_extended_values_and_fve_current PASSED [ 23%]
tests/test_data_sensor_extra.py::test_grid_mode_king_and_queen PASSED    [ 23%]
tests/test_data_sensor_extra.py::test_local_entity_value_mapping PASSED  [ 23%]
tests/test_data_sensor_extra.py::test_handle_coordinator_update PASSED   [ 23%]
tests/test_data_sensor_grid_mode.py::test_grid_mode_limited_king PASSED  [ 23%]
tests/test_data_sensor_grid_mode.py::test_grid_mode_off_when_disabled PASSED [ 23%]
tests/test_data_sensor_grid_mode.py::test_grid_mode_queen_branch PASSED  [ 23%]
tests/test_data_sensor_more.py::test_fallback_value_uses_last_state PASSED [ 23%]
tests/test_data_sensor_more.py::test_fallback_value_restored_state PASSED [ 23%]
tests/test_data_sensor_more.py::test_fallback_value_energy_default PASSED [ 23%]
tests/test_data_sensor_more.py::test_get_local_entity_id_for_config_prefers_existing_state PASSED [ 23%]
tests/test_data_sensor_more.py::test_get_local_entity_id_for_config_default_domain PASSED [ 23%]
tests/test_data_sensor_more.py::test_apply_local_value_map_and_coerce PASSED [ 23%]
tests/test_data_sensor_more.py::test_get_extended_value_out_of_range PASSED [ 23%]
tests/test_data_sensor_more.py::test_compute_fve_current_voltage_zero PASSED [ 23%]
tests/test_data_sensor_more.py::test_local_grid_mode_uses_local_values PASSED [ 23%]
tests/test_data_sensor_more.py::test_grid_mode_fallbacks_to_local PASSED [ 23%]
tests/test_data_sensor_more.py::test_handle_coordinator_update_no_data PASSED [ 23%]
tests/test_data_sensor_more.py::test_handle_coordinator_update_unchanged PASSED [ 23%]
tests/test_data_sensor_more.py::test_notification_manager_missing PASSED [ 24%]
tests/test_data_sensor_more.py::test_bypass_status_missing_manager PASSED [ 24%]
tests/test_data_sensor_more.py::test_notification_counts_and_attributes PASSED [ 24%]
tests/test_data_sensor_more.py::test_latest_notification_attributes PASSED [ 24%]
tests/test_data_sensor_more.py::test_bypass_status_attributes PASSED     [ 24%]
tests/test_data_sensor_more.py::test_special_state_mappings PASSED       [ 24%]
tests/test_data_sensor_more.py::test_grid_mode_queen_changing PASSED     [ 24%]
tests/test_data_sensor_more.py::test_grid_mode_king_changing PASSED      [ 24%]
tests/test_data_sensor_more.py::test_grid_mode_missing_data PASSED       [ 24%]
tests/test_data_sensor_more.py::test_get_local_value_unknown_state PASSED [ 24%]
tests/test_data_sensor_more.py::test_get_node_value_missing PASSED       [ 24%]
tests/test_data_sensor_more.py::test_get_extended_value_for_sensor_types PASSED [ 24%]
tests/test_data_sensor_more.py::test_compute_fve_current_second_channel PASSED [ 24%]
tests/test_data_sensor_more.py::test_get_extended_value_handles_missing PASSED [ 24%]
tests/test_data_sensor_more.py::test_async_added_and_removed PASSED      [ 24%]
tests/test_data_sensor_more.py::test_state_handles_invalid_grid_value PASSED [ 24%]
tests/test_data_sensor_more.py::test_state_extended_import_error PASSED  [ 24%]
tests/test_data_sensor_more.py::test_resolve_box_id_fallback PASSED      [ 24%]
tests/test_data_source_controller.py::test_init_data_source_state_local_ok PASSED [ 24%]
tests/test_data_source_controller.py::test_init_data_source_state_proxy_mismatch PASSED [ 25%]
tests/test_data_source_controller.py::test_update_state_cloud_only_forces_cloud PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_tracks_pending PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_ignored_cloud_only PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_wrong_entity PASSED [ 25%]
tests/test_data_source_controller.py::test_schedule_debounced_poke_failure PASSED [ 25%]
tests/test_data_source_controller.py::test_update_state_proxy_missing PASSED [ 25%]
tests/test_data_source_controller.py::test_on_effective_mode_changed_handles_errors PASSED [ 25%]
tests/test_data_source_controller.py::test_poke_coordinator_handles_error PASSED [ 25%]
tests/test_data_source_controller.py::test_handle_local_event_updates_coordinator PASSED [ 25%]
tests/test_data_source_controller.py::test_async_start_fallback_listeners PASSED [ 25%]
tests/test_data_source_controller.py::test_init_data_source_state_entry_options_error PASSED [ 25%]
tests/test_data_source_controller.py::test_init_data_source_state_local_stale_reason PASSED [ 25%]
tests/test_data_source_controller.py::test_init_data_source_state_proxy_box_missing PASSED [ 25%]
tests/test_data_source_controller.py::test_init_data_source_state_cloud_only_effective PASSED [ 25%]
tests/test_data_source_controller.py::test_async_start_seed_error PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_state_read_error PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_entity_id_not_str PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_box_id_mismatch PASSED [ 25%]
tests/test_data_source_controller.py::test_on_any_state_change_proxy_box_mismatch PASSED [ 26%]
tests/test_data_source_controller.py::test_async_start_with_event_helpers PASSED [ 26%]
tests/test_data_source_controller.py::test_on_proxy_change_triggers_mode_change PASSED [ 26%]
tests/test_data_source_controller.py::test_on_periodic_triggers_mode_change PASSED [ 26%]
tests/test_data_source_controller.py::test_async_stop_unsub_errors PASSED [ 26%]
tests/test_data_source_controller.py::test_init_data_source_state_proxy_entity_dt_error PASSED [ 26%]
tests/test_data_source_controller.py::test_async_start_fallback_listener_invokes_proxy_change PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_entity_id_not_str_local PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_wrong_prefix_local PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_expected_box_id_error PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_regex_no_match PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_coerce_box_id_exception PASSED [ 26%]
tests/test_data_source_controller.py::test_on_any_state_change_time_fired_error PASSED [ 26%]
tests/test_data_source_controller.py::test_handle_local_event_mode_changed PASSED [ 26%]
tests/test_data_source_controller.py::test_handle_local_event_exception PASSED [ 26%]
tests/test_data_source_controller.py::test_update_state_proxy_parse_failed PASSED [ 26%]
tests/test_data_source_controller.py::test_update_state_proxy_entity_dt_exception PASSED [ 26%]
tests/test_data_source_controller.py::test_update_state_expected_box_error PASSED [ 26%]
tests/test_data_source_controller.py::test_update_state_local_entities_candidate PASSED [ 26%]
tests/test_data_source_controller.py::test_update_state_local_stale_reason PASSED [ 27%]
tests/test_data_source_controller.py::test_update_state_proxy_box_mismatch_reason PASSED [ 27%]
tests/test_data_source_helpers.py::test_parse_dt_variants PASSED         [ 27%]
tests/test_data_source_helpers.py::test_coerce_box_id_variants PASSED    [ 27%]
tests/test_data_source_helpers.py::test_coerce_box_id_regex_error PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_configured_mode_mapping PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_proxy_stale_minutes_default PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_local_event_debounce_ms_default PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_data_source_state_default PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_effective_mode PASSED        [ 27%]
tests/test_data_source_helpers.py::test_get_latest_local_entity_update PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_latest_local_entity_update_skips_unknown PASSED [ 27%]
tests/test_data_source_helpers.py::test_get_latest_local_entity_update_exception PASSED [ 27%]
tests/test_detail_tabs_blocks.py::test_determine_block_status_fixed_tabs PASSED [ 27%]
tests/test_detail_tabs_blocks.py::test_determine_block_status_current_and_planned PASSED [ 27%]
tests/test_detail_tabs_blocks.py::test_determine_block_status_invalid_time PASSED [ 27%]
tests/test_detail_tabs_blocks.py::test_determine_block_status_missing_time PASSED [ 27%]
tests/test_detail_tabs_blocks.py::test_get_mode_from_intervals PASSED    [ 27%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_guard_exception PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_price_band_hold PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_price_band_hold_no_future PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_price_band_hold_no_price PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_ups_charge PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_guard_forced_mode PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_guard_no_time PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_dominant_other PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_ups_price_limit PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_ups_high_price_no_charge PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_no_entries PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_modes PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_summarize_block_reason_actual_only PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab PASSED  [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab_empty PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab_skips_empty_group PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab_planned_only PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab_non_dict_payload PASSED [ 28%]
tests/test_detail_tabs_blocks.py::test_build_mode_blocks_for_tab_completed_mismatch PASSED [ 28%]
tests/test_detail_tabs_summary.py::test_default_metrics_summary PASSED   [ 29%]
tests/test_detail_tabs_summary.py::test_aggregate_interval_metrics PASSED [ 29%]
tests/test_detail_tabs_summary.py::test_calculate_tab_summary_empty PASSED [ 29%]
tests/test_detail_tabs_summary.py::test_calculate_tab_summary_with_blocks PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_positive_export_price_generates_revenue PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_negative_export_price_costs_money PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_summer_scenario_home_iii_loses_money PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_summer_scenario_smart_saves_money PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_export_price_calculation_percentage_model PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_export_price_calculation_fixed_model PASSED [ 29%]
tests/test_dual_price_simulation.py::TestDualPriceSystem::test_negative_spot_creates_negative_export PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_ups_absorbs_solar PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_iii_all_solar_to_battery PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_iii_exports_only_when_full PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_iii_no_export_when_battery_has_space PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_ii_fve_covers_load_first PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_ii_deficit_from_grid_not_battery PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_home_i_deficit_from_battery PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_night_all_modes_discharge_battery PASSED [ 29%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_battery_discharge_with_efficiency PASSED [ 30%]
tests/test_dual_price_simulation.py::TestSimulatorPhysics::test_hw_minimum_stops_discharge PASSED [ 30%]
tests/test_dual_price_simulation.py::TestFullDaySimulation::test_summer_day_comparison PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_get_season PASSED    [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_generate_profile_name_winter_heating PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_generate_profile_name_weekend_morning_spike PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_generate_profile_name_invalid_length PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_fill_missing_values_linear PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_build_daily_profiles_interpolates PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_build_72h_profiles PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_build_current_match PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_apply_floor_to_prediction PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_calculate_profile_similarity PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_extra_state_attributes_with_prediction PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_fill_missing_values_hour_median_fallback PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_fill_missing_values_global_fallback PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_build_daily_profiles_skips_missing_days PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_find_best_matching_profile_no_hourly_data PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_find_best_matching_profile_not_enough_days PASSED [ 30%]
tests/test_entities_adaptive_load_profiles.py::test_find_best_matching_profile_success PASSED [ 31%]
tests/test_entities_adaptive_load_profiles.py::test_native_value_no_data_and_with_prediction PASSED [ 31%]
tests/test_entities_adaptive_load_profiles.py::test_get_energy_unit_factor PASSED [ 31%]
tests/test_entities_adaptive_load_profiles.py::test_create_and_update_profile_warming_up PASSED [ 31%]
tests/test_entities_adaptive_load_profiles.py::test_create_and_update_profile_sends_signal PASSED [ 31%]
tests/test_entities_adaptive_load_profiles.py::test_wait_for_next_profile_window PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_parse_tariff_times PASSED  [ 31%]
tests/test_entities_analytics_sensor.py::test_calculate_current_tariff_single PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_calculate_current_tariff_weekday PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_calculate_current_tariff_weekend PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_get_next_tariff_change PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_calculate_tariff_intervals_single_tariff PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_get_tariff_for_datetime_weekend PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_final_price_with_fees_percentage PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_final_price_with_fees_fixed PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_get_today_extreme_price PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_dynamic_spot_exchange_rate PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_calculate_fixed_final_price_for_datetime PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_get_spot_price_value_empty_data PASSED [ 31%]
tests/test_entities_analytics_sensor.py::test_get_fixed_price_value_min_max PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_calculate_fixed_daily_average_dual_tariff PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_get_next_tariff_change_single_tariff PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_calculate_tariff_intervals_dual_tariff_weekend PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_available_pricing_disabled PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_state_current_tariff_and_spot_price PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_extra_state_attributes_current_tariff PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_extra_state_attributes_hourly_fixed_prices PASSED [ 32%]
tests/test_entities_analytics_sensor.py::test_extra_state_attributes_hourly_dynamic PASSED [ 32%]
tests/test_entities_analytics_sensor_edge.py::test_fixed_prices_hourly_all_current_value PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_native_value_unavailable PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_native_value_no_spot_prices PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_calculate_current_tariff_fallback_yesterday PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_next_tariff_change_no_changes PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_calculate_tariff_intervals_no_changes PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_current_spot_price_eur_missing PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_today_average_price_missing PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_today_extreme_price_invalid_key PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_tomorrow_average_price_missing PASSED [ 32%]
tests/test_entities_analytics_sensor_more.py::test_get_spot_price_value_fixed_prices_eur PASSED [ 33%]
tests/test_entities_analytics_sensor_more.py::test_extra_state_attributes_no_spot_prices PASSED [ 33%]
tests/test_entities_analytics_sensor_more.py::test_available_pricing_enabled_success PASSED [ 33%]
tests/test_entities_analytics_sensor_more.py::test_state_error_path PASSED [ 33%]
tests/test_entities_analytics_sensor_more2.py::test_get_current_spot_price_missing_returns_none PASSED [ 33%]
tests/test_entities_analytics_sensor_more2.py::test_get_tariff_for_datetime_single PASSED [ 33%]
tests/test_entities_analytics_sensor_more3.py::test_dynamic_spot_price_paths PASSED [ 33%]
tests/test_entities_analytics_sensor_more3.py::test_fixed_price_paths_dual_tariff PASSED [ 33%]
tests/test_entities_analytics_sensor_more3.py::test_current_tariff_and_extra_attributes PASSED [ 33%]
tests/test_entities_analytics_sensor_more3.py::test_next_tariff_change_weekend PASSED [ 33%]
tests/test_entities_battery_balancing_sensor.py::test_format_hhmm PASSED [ 33%]
tests/test_entities_battery_balancing_sensor.py::test_parse_dt_local PASSED [ 33%]
tests/test_entities_battery_balancing_sensor.py::test_balancing_sensor_update_from_manager PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_format_hhmm PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_parse_dt_local_invalid PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_update_from_manager_disabled PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_update_from_manager_active_plan_balancing PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_update_from_manager_overdue PASSED [ 33%]
tests/test_entities_battery_balancing_sensor_more.py::test_async_added_to_hass_restores PASSED [ 33%]
tests/test_entities_battery_health_sensor.py::test_find_monotonic_charging_intervals PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_get_value_at_time_invalid_state PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_current_soh_and_capacity PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_storage_load_and_save PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_storage_load_and_save_errors PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_analyze_last_10_days_no_history PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_analyze_last_10_days_missing_sensors PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_analyze_last_10_days_happy_path PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_find_monotonic_intervals_ignores_unknown PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity_rejects_invalid PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity_missing_charge_values PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity_efficiency_invalid PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity_soh_limits PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_calculate_capacity_soh_too_low PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_get_value_at_time_empty PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_current_soh_and_capacity_empty PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_battery_health_sensor_lifecycle PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_battery_health_sensor_resolve_box_id_error PASSED [ 34%]
tests/test_entities_battery_health_sensor.py::test_battery_health_sensor_remove_and_initial_analysis PASSED [ 35%]
tests/test_entities_battery_health_sensor.py::test_battery_health_sensor_native_value_and_attrs PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_gps_coordinates_priority PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_gps_coordinates_fallback_to_ha PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_compute_severity_global_and_local PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_global_truncates_description PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_global_short_description PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_available_fallback_to_super PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_compute_severity_no_data PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_gps_coordinates_default PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_warning_data_from_coordinator PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_async_added_to_hass_sets_attribute_when_missing PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_available_with_cached_data PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_no_data PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_local_no_top_warning PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_local_with_details PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_local_regions_limit PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_extra_state_attributes_local_regions_exception PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_severity_distribution PASSED [ 35%]
tests/test_entities_chmu_sensor.py::test_get_severity_distribution_no_data PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_icon_thresholds PASSED          [ 36%]
tests/test_entities_chmu_sensor.py::test_device_info_passthrough PASSED  [ 36%]
tests/test_entities_chmu_sensor.py::test_load_and_save_persistent_data PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_load_persistent_data_no_warning PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_load_persistent_data_none PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_load_persistent_data_error PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_save_persistent_data_error PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_async_added_to_hass_fetches_immediately PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_async_added_to_hass_loads_cached PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_should_fetch_data PASSED        [ 36%]
tests/test_entities_chmu_sensor.py::test_delayed_initial_fetch PASSED    [ 36%]
tests/test_entities_chmu_sensor.py::test_periodic_update_triggers_fetch PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_fetch_warning_data_no_gps PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_fetch_warning_data_no_api PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_fetch_warning_data_success PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_fetch_warning_data_api_error_cached PASSED [ 36%]
tests/test_entities_chmu_sensor.py::test_fetch_warning_data_api_error_no_cache PASSED [ 36%]
tests/test_entities_computed_sensor.py::test_get_entity_number_and_oig_number PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_get_oig_last_updated PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_energy_store_load_and_save PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_format_time_variants PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_check_for_real_data_changes PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_batt_power_charge_discharge PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_extended_fve_current PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_get_energy_value_from_cache PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_accumulate_energy_charging PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_state_totals_from_entities PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_boiler_current_manual_and_auto_modes PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_reset_daily_resets_periods PASSED [ 37%]
tests/test_entities_computed_sensor.py::test_async_added_to_hass_restores_from_state PASSED [ 37%]
tests/test_entities_computed_sensor_edge.py::test_get_oig_number_invalid_box PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_get_entity_number_invalid_inputs PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_get_oig_number_invalid_box PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_get_oig_last_updated_naive_time PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_load_energy_from_storage_non_numeric PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_save_energy_to_storage_throttled PASSED [ 37%]
tests/test_entities_computed_sensor_more.py::test_state_real_data_update PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_state_various_aggregations PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_state_batt_comp_charge_discharge PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_state_capacity_variants_and_time PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_state_time_edge_strings PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_format_time_plural_variants PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_get_energy_value_missing_key PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_accumulate_energy_discharge PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_boiler_consumption_error PASSED [ 38%]
tests/test_entities_computed_sensor_more.py::test_cancel_reset_unsub_error PASSED [ 38%]
tests/test_entities_computed_sensor_more2.py::test_get_oig_last_updated_missing PASSED [ 38%]
tests/test_entities_computed_sensor_more2.py::test_accumulate_energy_missing_power PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_get_entity_number_variants PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_get_oig_number_invalid_box PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_get_oig_last_updated_missing_hass PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_get_oig_last_updated_invalid_box PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_get_oig_last_updated_handles_timezone PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_load_energy_from_storage_populates_defaults PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_load_energy_from_storage_cache PASSED [ 38%]
tests/test_entities_computed_sensor_more3.py::test_load_energy_from_storage_error PASSED [ 39%]
tests/test_entities_computed_sensor_more3.py::test_save_energy_to_storage_forced PASSED [ 39%]
tests/test_entities_computed_sensor_more3.py::test_save_energy_to_storage_error PASSED [ 39%]
tests/test_entities_data_sensor.py::test_get_mode_name_and_unknown PASSED [ 39%]
tests/test_entities_data_sensor.py::test_grid_mode_king_and_queen PASSED [ 39%]
tests/test_entities_data_sensor.py::test_apply_local_value_map_and_coerce PASSED [ 39%]
tests/test_entities_data_sensor.py::test_state_box_mode PASSED           [ 39%]
tests/test_entities_data_sensor.py::test_state_grid_mode_missing_data_uses_local PASSED [ 39%]
tests/test_entities_data_sensor.py::test_state_latest_notification_without_manager PASSED [ 39%]
tests/test_entities_data_sensor.py::test_extra_state_attributes_notification_manager PASSED [ 39%]
tests/test_entities_data_sensor.py::test_get_extended_value_and_compute_current PASSED [ 39%]
tests/test_entities_data_sensor_more.py::test_extended_value_lookup_and_mode_name PASSED [ 39%]
tests/test_entities_data_sensor_more.py::test_extended_value_missing_data PASSED [ 39%]
tests/test_entities_data_sensor_more2.py::test_extended_value_out_of_range PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_fallback_value_prefers_last_state PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_local_entity_id_suffix_and_domains PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_apply_local_value_map_numeric_conversion PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_get_local_grid_mode_failure PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_get_node_value_missing_node_key PASSED [ 39%]
tests/test_entities_data_sensor_more3.py::test_init_handles_sensor_types_import_error PASSED [ 40%]
tests/test_entities_data_sensor_more3.py::test_get_extended_value_unknown_mapping PASSED [ 40%]
tests/test_entities_data_sensor_more3.py::test_get_extended_value_index_out_of_range PASSED [ 40%]
tests/test_entities_data_source_sensor.py::test_state_local_vs_cloud PASSED [ 40%]
tests/test_entities_data_source_sensor.py::test_extra_state_attributes PASSED [ 40%]
tests/test_entities_data_source_sensor.py::test_async_added_and_removed PASSED [ 40%]
tests/test_entities_runtime.py::test_available_with_missing_node PASSED  [ 40%]
tests/test_entities_runtime.py::test_available_when_data_present PASSED  [ 40%]
tests/test_entities_runtime.py::test_device_info_categories PASSED       [ 40%]
tests/test_entities_runtime.py::test_name_uses_language PASSED           [ 40%]
tests/test_entities_shield_sensor.py::test_extract_param_type PASSED     [ 40%]
tests/test_entities_shield_sensor.py::test_translate_shield_state PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_queue_and_status PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_unavailable PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_mode_reaction_time PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_activity_and_idle PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_activity_fallback PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_state_changed_callback PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_registers_callback PASSED [ 40%]
tests/test_entities_shield_sensor.py::test_shield_sensor_extra_state_attributes PASSED [ 41%]
tests/test_entities_shield_sensor.py::test_shield_sensor_unique_id_device_info_available PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_parse_forecast_hour PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_should_fetch_data_daily_optimized PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_should_fetch_data_manual PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_get_update_interval PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_load_persistent_data PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_save_persistent_data PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_should_fetch_data_modes PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_convert_to_hourly_keeps_max PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_process_forecast_data_combines_strings PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_periodic_update_daily_optimized_triggers PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_periodic_update_daily_optimized_skips_recent PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_periodic_update_daily_calls PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_async_fetch_forecast_data_rate_limit PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_async_fetch_forecast_data_string1_only PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_broadcast_forecast_data_triggers_updates PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_async_added_to_hass_schedules_fetch PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_async_added_to_hass_uses_cached_data PASSED [ 41%]
tests/test_entities_solar_forecast_sensor.py::test_state_uses_coordinator_and_availability PASSED [ 42%]
tests/test_entities_solar_forecast_sensor.py::test_state_and_attributes_all_sensors PASSED [ 42%]
tests/test_entities_solar_forecast_sensor.py::test_periodic_update_every_4h_and_hourly PASSED [ 42%]
tests/test_entities_solar_forecast_sensor.py::test_manual_update_handles_failure PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_parse_forecast_hour_invalid PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_should_fetch_data_modes PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_get_update_interval PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_periodic_update_daily_optimized_skips PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_periodic_update_daily_only_at_six PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_async_fetch_forecast_rate_limit PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_async_fetch_forecast_string1_422 PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_async_fetch_forecast_no_strings PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_async_fetch_forecast_success PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_process_forecast_data_string2_only PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_convert_to_hourly_invalid_timestamp PASSED [ 42%]
tests/test_entities_solar_forecast_sensor_more.py::test_extra_state_attributes_string1_and_string2 PASSED [ 42%]
tests/test_entities_statistics_sensor.py::test_ensure_timezone_aware PASSED [ 42%]
tests/test_entities_statistics_sensor.py::test_safe_datetime_compare PASSED [ 42%]
tests/test_entities_statistics_sensor.py::test_create_hourly_attributes PASSED [ 42%]
tests/test_entities_statistics_sensor.py::test_statistics_processor_process_hourly_data PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_load_statistics_data PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_save_statistics_data PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_cleanup_old_data PASSED   [ 43%]
tests/test_entities_statistics_sensor.py::test_update_sampling_data_triggers_save PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_check_hourly_end_updates PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_available_disabled_statistics PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_available_hourly_with_source_entity PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_hourly_energy_diff_kwh PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_hourly_energy_diff_wh PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_hourly_energy_power_integral_w PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_statistics_value_interval_median PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_statistics_value_uses_all_samples_when_stale PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_extra_state_attributes_hourly_totals PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_get_actual_load_value PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_daily_statistics_update_saves PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_calculate_interval_statistics_from_history_cross_midnight PASSED [ 43%]
tests/test_entities_statistics_sensor.py::test_state_hourly_without_coordinator_data PASSED [ 43%]
tests/test_entities_statistics_sensor_edge.py::test_available_hourly_missing_entity PASSED [ 43%]
tests/test_entities_statistics_sensor_more.py::test_load_statistics_data_invalid_records PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_save_statistics_data_store_failure PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_update_sampling_data_no_value PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_check_hourly_end_skips_outside_window PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_check_hourly_end_skip_same_hour PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_calculate_hourly_energy_unknown_unit_energy_diff PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_calculate_hourly_energy_power_integral_kw PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_calculate_hourly_energy_initial_none PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_calculate_statistics_value_interval_empty PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_extra_state_attributes_battery_load_median PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_extra_state_attributes_interval PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_available_hourly_unavailable_state PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_create_hourly_attributes_error PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_safe_datetime_compare_error PASSED [ 44%]
tests/test_entities_statistics_sensor_more.py::test_calculate_interval_statistics_from_history_no_data PASSED [ 44%]
tests/test_entities_statistics_sensor_more2.py::test_get_actual_load_value_invalid PASSED [ 44%]
tests/test_entities_statistics_sensor_more3.py::test_is_correct_day_type PASSED [ 44%]
tests/test_entities_statistics_sensor_more3.py::test_calculate_interval_statistics_without_range PASSED [ 44%]
tests/test_entities_statistics_sensor_more3.py::test_calculate_interval_statistics_no_history PASSED [ 44%]
tests/test_entities_statistics_sensor_more3.py::test_calculate_interval_statistics_with_data PASSED [ 45%]
tests/test_etag_caching.py::TestETagCaching::test_first_request_without_etag PASSED [ 45%]
tests/test_etag_caching.py::TestETagCaching::test_second_request_with_304 PASSED [ 45%]
tests/test_etag_caching.py::TestETagCaching::test_etag_change_updates_cache PASSED [ 45%]
tests/test_etag_caching.py::TestETagCaching::test_no_etag_support PASSED [ 45%]
tests/test_etag_caching.py::TestETagCaching::test_extended_stats_etag PASSED [ 45%]
tests/test_etag_caching.py::TestJitter::test_jitter_range PASSED         [ 45%]
tests/test_etag_caching.py::TestJitter::test_jitter_stored PASSED        [ 45%]
tests/test_extended_summary.py::test_aggregate_cost_by_day PASSED        [ 45%]
tests/test_extended_summary.py::test_get_day_cost_from_timeline PASSED   [ 45%]
tests/test_extended_summary.py::test_format_planned_data PASSED          [ 45%]
tests/test_extended_summary.py::test_format_actual_data PASSED           [ 45%]
tests/test_extended_summary.py::test_calculate_day_summary PASSED        [ 45%]
tests/test_extended_summary.py::test_build_today_tile_summary PASSED     [ 45%]
tests/test_extended_summary.py::test_build_today_tile_summary_handles_missing_time_and_costs PASSED [ 45%]
tests/test_extended_summary.py::test_build_today_tile_summary_confidence_low PASSED [ 45%]
tests/test_extended_summary.py::test_build_today_tile_summary_confidence_high PASSED [ 45%]
tests/test_extended_summary.py::test_get_empty_tile_summary PASSED       [ 45%]
tests/test_extended_summary.py::test_build_today_tile_summary_empty PASSED [ 46%]
tests/test_forecast_update.py::test_async_update_skips_when_in_progress PASSED [ 46%]
tests/test_forecast_update.py::test_async_update_skips_same_bucket PASSED [ 46%]
tests/test_forecast_update.py::test_async_update_missing_capacity_schedules_retry PASSED [ 46%]
tests/test_forecast_update.py::test_async_update_happy_path PASSED       [ 46%]
tests/test_grid_charging_plan_sensor.py::test_calculate_charging_intervals PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_fallback PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_log_rate_limited PASSED    [ 46%]
tests/test_grid_charging_plan_sensor.py::test_init_resolve_box_id_fallback PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_get_active_plan_key PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_missing_entry_data PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_missing_config_entry PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_missing_service_shield PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_missing_tracker PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_missing_tracker_attribute PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_tracker_exception PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_dynamic_offset_with_tracker PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_from_detail_tabs PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_without_detail_tabs PASSED [ 46%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_tomorrow_non_ups PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_load_ups_blocks_updates_cache PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_empty_sources PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_skips_completed PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_get_home_ups_blocks_handles_exception PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_parse_time_to_datetime_invalid PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_get_next_mode_after_ups PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_native_value_on_and_off PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_native_value_tomorrow_block_off PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_native_value_invalid_time_format PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_native_value_next_mode_offset PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_native_value_wraps_midnight PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_async_added_to_hass_loads_blocks PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_handle_coordinator_update PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_extra_state_attributes PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_constructor_with_config PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_extra_state_attributes_empty PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_current_mode_fallback PASSED [ 47%]
tests/test_grid_charging_plan_sensor.py::test_parse_time_to_datetime_tomorrow PASSED [ 47%]
tests/test_ha_rest_api_helpers.py::test_transform_timeline_for_api PASSED [ 48%]
tests/test_ha_rest_api_helpers.py::test_find_entry_for_box PASSED        [ 48%]
tests/test_ha_rest_api_more.py::test_transform_timeline_for_api PASSED   [ 48%]
tests/test_ha_rest_api_more.py::test_find_entry_for_box PASSED           [ 48%]
tests/test_ha_rest_api_more.py::test_battery_timeline_store_error_and_missing_entity PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_battery_timeline_timeline_hybrid PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_battery_timeline_entity_precomputed_error PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_spot_prices_view_spot_ok PASSED     [ 48%]
tests/test_ha_rest_api_more.py::test_spot_prices_view_exception PASSED   [ 48%]
tests/test_ha_rest_api_more.py::test_analytics_view_missing_component PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_analytics_view_exception PASSED     [ 48%]
tests/test_ha_rest_api_more.py::test_consumption_profiles_view_exception PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_balancing_decisions_warning_path PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_balancing_decisions_exception PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_unified_cost_tile_legacy_key PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_unified_cost_tile_store_error_component_missing PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_unified_cost_tile_build_error PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_detail_tabs_precomputed_hybrid_tab_all PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_detail_tabs_entity_components_fallback PASSED [ 48%]
tests/test_ha_rest_api_more.py::test_detail_tabs_precomputed_store_on_entity PASSED [ 49%]
tests/test_ha_rest_api_more.py::test_planner_settings_post_no_change PASSED [ 49%]
tests/test_ha_rest_api_more.py::test_planner_settings_entry_missing PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_battery_timeline_view_precomputed PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_battery_timeline_view_missing_sensor_component PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_battery_timeline_view_entity_precomputed PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_spot_prices_view_invalid_type PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_spot_prices_view_valid PASSED      [ 49%]
tests/test_ha_rest_api_views.py::test_spot_prices_view_missing_component PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_spot_prices_view_missing_entity PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_unified_cost_tile_view_precomputed PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_detail_tabs_view_precomputed PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_consumption_profiles_view_missing_component PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_consumption_profiles_view_missing_entity PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_consumption_profiles_view_ok PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_balancing_decisions_view_missing_component PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_balancing_decisions_view_missing_entity PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_balancing_decisions_view_ok PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_planner_settings_view_get_and_post PASSED [ 49%]
tests/test_ha_rest_api_views.py::test_planner_settings_view_invalid_payload PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_dashboard_modules_view PASSED      [ 50%]
tests/test_ha_rest_api_views.py::test_dashboard_modules_view_missing PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_setup_api_endpoints_registers_views PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_analytics_view_ok PASSED           [ 50%]
tests/test_ha_rest_api_views.py::test_analytics_view_missing_entity PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_planner_settings_view_invalid_json PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_planner_settings_view_no_change PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_dashboard_modules_view_ok PASSED   [ 50%]
tests/test_ha_rest_api_views.py::test_dashboard_modules_view_missing_entry PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_detail_tabs_view_fallback PASSED   [ 50%]
tests/test_ha_rest_api_views.py::test_battery_timeline_view_entity_fallback PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_unified_cost_tile_view_build_from_entity PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_unified_cost_tile_view_missing_build_method PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_planner_settings_view_missing_entry PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_dashboard_modules_view_wrong_domain PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_detail_tabs_view_missing_component PASSED [ 50%]
tests/test_ha_rest_api_views.py::test_detail_tabs_view_missing_build_method PASSED [ 50%]
tests/test_ha_sensor.py::test_sensor_proxy_properties PASSED             [ 50%]
tests/test_ha_sensor.py::test_sensor_async_update_proxy PASSED           [ 51%]
tests/test_ha_sensor.py::test_sensor_analysis_proxies PASSED             [ 51%]
tests/test_ha_sensor.py::test_sensor_battery_state_proxies PASSED        [ 51%]
tests/test_ha_sensor_proxy.py::test_state_and_availability_proxies PASSED [ 51%]
tests/test_ha_sensor_proxy.py::test_extra_state_attributes_proxy PASSED  [ 51%]
tests/test_ha_sensor_proxy.py::test_calculate_data_hash_proxy PASSED     [ 51%]
tests/test_ha_sensor_proxy.py::test_async_update_calls_forecast PASSED   [ 51%]
tests/test_ha_sensor_proxy.py::test_build_detail_tabs_passes_mode_names PASSED [ 51%]
tests/test_ha_sensor_proxy.py::test_build_timeline_extended PASSED       [ 51%]
tests/test_ha_sensor_proxy.py::test_schedule_precompute_proxy PASSED     [ 51%]
tests/test_ha_sensor_proxy.py::test_simulate_interval_proxy PASSED       [ 51%]
tests/test_ha_sensor_proxy.py::test_scenario_analysis_proxies PASSED     [ 51%]
tests/test_ha_sensor_proxy.py::test_storage_and_task_proxies PASSED      [ 51%]
tests/test_ha_sensor_proxy.py::test_precompute_and_cost_tile_proxy PASSED [ 51%]
tests/test_ha_sensor_proxy.py::test_additional_proxy_helpers PASSED      [ 51%]
tests/test_history_helpers.py::test_safe_float_and_build_ids PASSED      [ 51%]
tests/test_history_helpers.py::test_select_interval_states_in_range_and_neighbors PASSED [ 51%]
tests/test_history_helpers.py::test_calc_delta_kwh_handles_edge_cases PASSED [ 51%]
tests/test_history_helpers.py::test_get_values_and_parse_start PASSED    [ 51%]
tests/test_history_helpers.py::test_build_actual_interval_entry_rounding PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_interval_from_history_basic PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_interval_from_history_no_hass PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_interval_from_history_no_states PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_interval_from_history_exception PASSED [ 52%]
tests/test_history_helpers.py::test_patch_existing_actual PASSED         [ 52%]
tests/test_history_helpers.py::test_build_new_actual_intervals PASSED    [ 52%]
tests/test_history_helpers.py::test_normalize_mode_history PASSED        [ 52%]
tests/test_history_helpers.py::test_expand_modes_to_intervals PASSED     [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_no_hass PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_empty PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_import_error PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_empty_states PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_exception PASSED [ 52%]
tests/test_history_helpers.py::test_fetch_mode_history_from_recorder_filters_states PASSED [ 52%]
tests/test_history_helpers.py::test_map_mode_name_to_id_unknown PASSED   [ 52%]
tests/test_history_helpers.py::test_map_mode_name_to_id_fallbacks PASSED [ 52%]
tests/test_history_helpers.py::test_build_historical_modes_lookup PASSED [ 52%]
tests/test_history_helpers.py::test_build_historical_modes_lookup_no_hass PASSED [ 52%]
tests/test_history_helpers.py::test_update_actual_from_history_no_plan PASSED [ 53%]
tests/test_history_helpers.py::test_update_actual_from_history_updates PASSED [ 53%]
tests/test_history_helpers.py::test_update_actual_from_history_existing_state PASSED [ 53%]
tests/test_home_ii_deficit_critical_bug.py::TestHOMEIIDeficitBehavior::test_home_ii_surplus_charges_battery PASSED [ 53%]
tests/test_home_ii_deficit_critical_bug.py::TestHOMEIIDeficitBehavior::test_home_ii_deficit_uses_grid_NOT_battery PASSED [ 53%]
tests/test_home_ii_deficit_critical_bug.py::TestHOMEIIDeficitBehavior::test_home_ii_night_discharges_normally PASSED [ 53%]
tests/test_home_ii_deficit_critical_bug.py::TestHOMEIIDeficitBehavior::test_home_ii_vs_home_i_deficit_difference PASSED [ 53%]
tests/test_hybrid_scoring_helpers.py::test_extract_prices PASSED         [ 53%]
tests/test_hybrid_scoring_helpers.py::test_analyze_future_prices_negative PASSED [ 53%]
tests/test_hybrid_scoring_helpers.py::test_handle_negative_price_variants PASSED [ 53%]
tests/test_hybrid_scoring_helpers.py::test_apply_smoothing_merges_short_runs PASSED [ 53%]
tests/test_hybrid_scoring_helpers.py::test_score_mode_ups_penalized_when_disabled PASSED [ 53%]
tests/test_hybrid_scoring_helpers.py::test_calculate_baseline_cost PASSED [ 53%]
tests/test_init_cleanup.py::test_cleanup_invalid_empty_devices PASSED    [ 53%]
tests/test_init_cleanup.py::test_cleanup_invalid_empty_devices_with_entities PASSED [ 53%]
tests/test_init_cleanup.py::test_cleanup_invalid_empty_devices_skips_invalid_sets PASSED [ 53%]
tests/test_init_cleanup.py::test_cleanup_invalid_empty_devices_exception PASSED [ 53%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids_exceptions PASSED [ 53%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids_enable_and_remove_failures PASSED [ 53%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids_first_update_failure PASSED [ 54%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids_second_update_failure PASSED [ 54%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids_startswith_flip PASSED [ 54%]
tests/test_init_cleanup.py::test_migrate_entity_unique_ids PASSED        [ 54%]
tests/test_init_cleanup.py::test_cleanup_unused_devices_removes_or_keeps PASSED [ 54%]
tests/test_init_extra.py::test_setup_telemetry_success PASSED            [ 54%]
tests/test_init_extra.py::test_setup_telemetry_no_handler PASSED         [ 54%]
tests/test_init_extra.py::test_setup_telemetry_exception PASSED          [ 54%]
tests/test_init_extra.py::test_async_setup PASSED                        [ 54%]
tests/test_init_extra.py::test_cleanup_unused_devices PASSED             [ 54%]
tests/test_init_extra.py::test_cleanup_unused_devices_regex_and_remove_error PASSED [ 54%]
tests/test_init_extra.py::test_cleanup_unused_devices_none_removed PASSED [ 54%]
tests/test_init_extra.py::test_async_remove_config_entry_device PASSED   [ 54%]
tests/test_init_extra.py::test_async_remove_config_entry_device_exception PASSED [ 54%]
tests/test_init_extra.py::test_async_unload_entry PASSED                 [ 54%]
tests/test_init_extra.py::test_async_unload_entry_handles_stop_error PASSED [ 54%]
tests/test_init_extra.py::test_async_reload_entry PASSED                 [ 54%]
tests/test_init_extra.py::test_async_update_options_disabled PASSED      [ 54%]
tests/test_init_extra.py::test_async_update_options_enable_dashboard PASSED [ 55%]
tests/test_init_extra.py::test_async_update_options_needs_reload PASSED  [ 55%]
tests/test_init_extra.py::test_async_update_options_disable_dashboard_change PASSED [ 55%]
tests/test_init_extra.py::test_cleanup_unused_devices_exception PASSED   [ 55%]
tests/test_init_frontend.py::test_register_static_paths PASSED           [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_registers PASSED  [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_resolves_box_id_and_handles_errors PASSED [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_missing_register PASSED [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_noncallable_register PASSED [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_resolve_box_id_error PASSED [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_entity_checks PASSED [ 55%]
tests/test_init_frontend.py::test_setup_frontend_panel_options_get_raises PASSED [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_no_method PASSED [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_success PASSED   [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_exception PASSED [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_outer_exception PASSED [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_value_error PASSED [ 55%]
tests/test_init_frontend.py::test_remove_frontend_panel_unknown PASSED   [ 55%]
tests/test_init_helpers.py::test_read_manifest_file PASSED               [ 55%]
tests/test_init_helpers.py::test_ensure_data_source_option_defaults PASSED [ 56%]
tests/test_init_helpers.py::test_ensure_data_source_option_defaults_no_update PASSED [ 56%]
tests/test_init_helpers.py::test_ensure_planner_option_defaults_removes_obsolete PASSED [ 56%]
tests/test_init_helpers.py::test_ensure_planner_option_defaults_invalid_max_price PASSED [ 56%]
tests/test_init_helpers.py::test_balancing_manager_import_error PASSED   [ 56%]
tests/test_init_helpers.py::test_infer_box_id_from_local_entities PASSED [ 56%]
tests/test_init_helpers.py::test_infer_box_id_from_local_entities_exception PASSED [ 56%]
tests/test_init_helpers.py::test_register_static_paths PASSED            [ 56%]
tests/test_init_helpers.py::test_setup_frontend_panel_registers PASSED   [ 56%]
tests/test_init_helpers.py::test_remove_frontend_panel_handles_unknown PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_missing_credentials PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_success_local PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_success_cloud PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_migrates_spot_prices_flag PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_infers_box_id_from_proxy PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_infers_box_id_from_registry PASSED [ 56%]
tests/test_init_setup_entry.py::test_infer_box_id_from_local_entities PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_cloud_empty_stats PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_service_shield_failure PASSED [ 56%]
tests/test_init_setup_entry.py::test_async_setup_entry_cloud_missing_live_data PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_infer_box_id_exception PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_live_data_check_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_no_coordinator_data PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_notification_manager_fetch_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_pricing_init_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_optional_modules PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_disabled_and_missing_manager PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_boiler_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_telemetry_store_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_shield_device_info_resolve_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_notification_manager_no_device PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_notification_manager_init_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_notification_manager_box_id_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_persist_box_id_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_solar_forecast_error PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_manager_paths PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_manager_no_box_id PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_manager_executes PASSED [ 57%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_manager_callbacks PASSED [ 58%]
tests/test_init_setup_entry.py::test_async_setup_entry_balancing_manager_initial_plan PASSED [ 58%]
tests/test_init_setup_entry.py::test_async_setup_entry_shield_monitoring_no_telemetry PASSED [ 58%]
tests/test_input_helpers.py::test_get_solar_for_timestamp_today PASSED   [ 58%]
tests/test_input_helpers.py::test_get_load_avg_for_timestamp_match PASSED [ 58%]
tests/test_input_helpers.py::test_get_load_avg_for_timestamp_empty PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_solar_for_timestamp_tomorrow_and_missing PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_solar_for_timestamp_invalid_value PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_solar_for_timestamp_timezone_aware_key PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_load_avg_for_timestamp_no_match PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_load_avg_for_timestamp_zero_value_fallback PASSED [ 58%]
tests/test_input_helpers_more.py::test_get_load_avg_for_timestamp_invalid_range PASSED [ 58%]
tests/test_input_helpers_more.py::test_empty_load_avg_state_flag PASSED  [ 58%]
tests/test_interval_simulator.py::test_interval_result_properties PASSED [ 58%]
tests/test_interval_simulator.py::test_simulate_uses_shared_simulator PASSED [ 58%]
tests/test_interval_simulator.py::test_discharge_for_load PASSED         [ 58%]
tests/test_interval_simulator.py::test_simulate_home_i_day_and_night PASSED [ 58%]
tests/test_interval_simulator.py::test_simulate_home_ii PASSED           [ 58%]
tests/test_interval_simulator.py::test_simulate_home_iii PASSED          [ 58%]
tests/test_interval_simulator.py::test_simulate_home_ups PASSED          [ 59%]
tests/test_interval_simulator.py::test_calculate_cost PASSED             [ 59%]
tests/test_interval_simulator.py::test_simulate_home_i_and_ii_curtailed PASSED [ 59%]
tests/test_interval_simulator.py::test_create_simulator PASSED           [ 59%]
tests/test_load_and_solar_profiles.py::test_get_load_avg_sensors PASSED  [ 59%]
tests/test_load_and_solar_profiles.py::test_get_solar_forecast_from_attributes PASSED [ 59%]
tests/test_load_and_solar_profiles.py::test_get_solar_forecast_from_cache PASSED [ 59%]
tests/test_load_and_solar_profiles.py::test_get_solar_forecast_strings PASSED [ 59%]
tests/test_load_profiles_more.py::test_get_load_avg_sensors_no_hass PASSED [ 59%]
tests/test_load_profiles_more.py::test_get_load_avg_sensors_invalid_state PASSED [ 59%]
tests/test_load_profiles_more.py::test_get_load_avg_sensors_unavailable_and_bad PASSED [ 59%]
tests/test_local_mapper.py::test_coerce_and_normalize_box_mode PASSED    [ 59%]
tests/test_local_mapper.py::test_normalize_domains_and_value_map PASSED  [ 59%]
tests/test_local_mapper.py::test_as_utc PASSED                           [ 59%]
tests/test_local_mapper_more.py::test_apply_state_unknown_entity PASSED  [ 59%]
tests/test_local_mapper_more.py::test_apply_state_node_update_box_mode PASSED [ 59%]
tests/test_local_mapper_more.py::test_apply_state_extended_update PASSED [ 59%]
tests/test_local_mapper_more.py::test_apply_state_unknown_suffix PASSED  [ 59%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_empty PASSED [ 59%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_invalid_time PASSED [ 60%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_no_future_intervals PASSED [ 60%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_block_changes_and_split PASSED [ 60%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_bad_end_time PASSED [ 60%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_final_block_parse_error PASSED [ 60%]
tests/test_mode_recommendations.py::test_create_mode_recommendations_block_parse_error PASSED [ 60%]
tests/test_mode_recommendations.py::test_add_block_details_modes PASSED  [ 60%]
tests/test_mode_recommendations.py::test_add_block_details_home_iii_solar PASSED [ 60%]
tests/test_mode_recommendations.py::test_add_block_details_ups_low_price PASSED [ 60%]
tests/test_mode_recommendations.py::test_add_block_details_fallbacks PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_async_setup_tracks_listener PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_track_request_skips_same_mode PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_async_mode_changed_updates_history PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_get_offset_for_scenario_uses_p95 PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_async_load_historical_data_handles_missing PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_async_load_historical_data_parses_transitions PASSED [ 60%]
tests/test_mode_transition_tracker.py::test_async_cleanup_unsubscribes PASSED [ 60%]
tests/test_models.py::TestModels::test_ac_in_b_data PASSED               [ 60%]
tests/test_models.py::TestModels::test_ac_in_b_data_defaults PASSED      [ 60%]
tests/test_models.py::TestModels::test_ac_in_data PASSED                 [ 61%]
tests/test_models.py::TestModels::test_ac_out_data PASSED                [ 61%]
tests/test_models.py::TestModels::test_ac_out_data_optional_fields PASSED [ 61%]
tests/test_models.py::TestModels::test_actual_data PASSED                [ 61%]
tests/test_models.py::TestModels::test_battery_data PASSED               [ 61%]
tests/test_models.py::TestModels::test_battery_data_partial PASSED       [ 61%]
tests/test_models.py::TestModels::test_battery_params PASSED             [ 61%]
tests/test_models.py::TestModels::test_boiler_data PASSED                [ 61%]
tests/test_models.py::TestModels::test_boiler_data_empty PASSED          [ 61%]
tests/test_models.py::TestModels::test_boiler_params PASSED              [ 61%]
tests/test_models.py::TestModels::test_boiler_params_defaults PASSED     [ 61%]
tests/test_models.py::TestModels::test_box_data PASSED                   [ 61%]
tests/test_models.py::TestModels::test_box_params PASSED                 [ 61%]
tests/test_models.py::TestModels::test_box_params2 PASSED                [ 61%]
tests/test_models.py::TestModels::test_box_params2_defaults PASSED       [ 61%]
tests/test_models.py::TestModels::test_box_params_no_sw PASSED           [ 61%]
tests/test_models.py::TestModels::test_dc_in_data PASSED                 [ 61%]
tests/test_models.py::TestModels::test_dc_in_data_defaults PASSED        [ 61%]
tests/test_models.py::TestModels::test_device_data PASSED                [ 61%]
tests/test_models.py::TestModels::test_invertor_params PASSED            [ 62%]
tests/test_models.py::TestModels::test_invertor_params1 PASSED           [ 62%]
tests/test_models.py::TestModels::test_oig_cloud_data_from_dict PASSED   [ 62%]
tests/test_models.py::TestModels::test_oig_cloud_device_data_from_dict PASSED [ 62%]
tests/test_models.py::TestModels::test_oig_cloud_device_data_special_bat_c_case PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_i_solar_covers_load PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_i_battery_covers_deficit PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_ii_preserves_battery_during_day PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_ii_discharges_at_night PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_iii_all_solar_to_battery PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_iii_export_only_when_full PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_home_ups_charges_from_grid PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_hw_minimum_stops_discharge PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_efficiency_applied_correctly PASSED [ 62%]
tests/test_new_architecture.py::TestIntervalSimulator::test_calculate_cost PASSED [ 62%]
tests/test_new_architecture.py::TestBalancingPlanFactories::test_create_natural_plan PASSED [ 62%]
tests/test_new_architecture.py::TestBalancingPlanFactories::test_create_opportunistic_plan PASSED [ 62%]
tests/test_new_architecture.py::TestBalancingPlanFactories::test_create_forced_plan PASSED [ 62%]
tests/test_new_architecture.py::TestHybridStrategy::test_optimize_returns_modes_for_all_intervals PASSED [ 62%]
tests/test_new_architecture.py::TestHybridStrategy::test_optimize_prefers_cheap_charging PASSED [ 63%]
tests/test_new_architecture.py::TestHybridStrategy::test_optimize_handles_negative_prices PASSED [ 63%]
tests/test_new_architecture.py::TestHybridStrategy::test_optimize_respects_balancing_plan PASSED [ 63%]
tests/test_new_architecture.py::TestHybridStrategy::test_optimize_calculates_savings PASSED [ 63%]
tests/test_new_architecture.py::TestFactoryFunctions::test_create_simulator PASSED [ 63%]
tests/test_new_architecture.py::TestIntegration::test_full_day_optimization PASSED [ 63%]
tests/test_oig_cloud_api.py::test_opentelemetry_import PASSED            [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_ssl_context_cached PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_connector_modes PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats PASSED      [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_etag_cache PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_success PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_failure_wrong_response PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_failure_http_error PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_timeout PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_ssl_fallback_success PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_ssl_fallback_exhausted PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_unexpected_error PASSED [ 63%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_authenticate_no_ssl_modes_left PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_session_not_authenticated PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_session_headers PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_auth_retry PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_update_cache_with_etag PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_timeout_cached PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_timeout_raises PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_connection_cached PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_connection_raises PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_unexpected_cached PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_stats_internal_unexpected_raises PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_304_retry_failure PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_304_retry_success PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_http_error PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_timeout PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_try_get_stats_connection_error PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_box_mode PASSED   [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_limit PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_boiler_mode PASSED [ 64%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_box_mode_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_limit_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_boiler_mode_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_ssr_rele_errors PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_box_params_internal PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_box_params_internal_not_authenticated PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_box_params_internal_failure PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_no_telemetry PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_no_box_id PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_http_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_grid_delivery_exception PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_battery_formating_success PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_battery_formating_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_formating_mode PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_formating_mode_http_error PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_set_formating_mode_exception PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_cached PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_retry_success PASSED [ 65%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_json_error PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_auth_retry PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_auth_retry_failed PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_http_error PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_retry_failure PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_extended_stats_exception PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_no_device PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_empty_content PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_success PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_auth_retry_success PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_auth_retry_failed PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_http_error PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_timeout PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_connection_error PASSED [ 66%]
tests/test_oig_cloud_api.py::TestOigCloudApi::test_get_notifications_exception PASSED [ 66%]
tests/test_oig_cloud_notification.py::test_parse_html_notifications PASSED [ 66%]
tests/test_oig_cloud_notification.py::test_parse_json_notifications_and_bypass_status PASSED [ 66%]
tests/test_oig_cloud_notification.py::test_parse_notification_fallback PASSED [ 66%]
tests/test_oig_cloud_notification.py::test_notification_manager_update_from_api PASSED [ 66%]
tests/test_oig_cloud_notification_more.py::test_parse_html_and_deduplicate PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_extract_html_from_json_wrapper PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_extract_show_notifications_payloads_and_json_objects PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_parse_single_notification_invalid_json PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_html_parser_row2_without_dash PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_extract_html_from_json_wrapper_invalid PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_detect_bypass_status_compact_indicators PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_parse_czech_datetime_invalid PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_detect_bypass_status_tokens PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_determine_notification_type_keywords PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_clean_json_string_fixes_formatting PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_create_notification_from_json_parses_timestamp PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_get_priority_name PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_parse_notification_fallback PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_manager_save_and_load_storage PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_manager_refresh_data PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_update_from_api_success PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_update_from_api_missing_device_id PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_update_from_api_missing_method_uses_cache PASSED [ 67%]
tests/test_oig_cloud_notification_more.py::test_update_from_api_error_uses_cache PASSED [ 68%]
tests/test_oig_cloud_notification_more.py::test_manager_counts_and_latest PASSED [ 68%]
tests/test_oig_cloud_notification_more.py::test_load_notifications_handles_error PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_log_api_session_info_variants PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_is_session_expired PASSED  [ 68%]
tests/test_oig_cloud_session_manager.py::test_api_property PASSED        [ 68%]
tests/test_oig_cloud_session_manager.py::test_rate_limit PASSED          [ 68%]
tests/test_oig_cloud_session_manager.py::test_call_with_retry_success PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_call_with_retry_auth_error PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_call_with_retry_unexpected_error PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_get_statistics_populates_rates PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_log_api_session_info_with_errors PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_ensure_auth_failure PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_wrapper_methods_cover_args PASSED [ 68%]
tests/test_oig_cloud_session_manager.py::test_close_resets_state PASSED  [ 68%]
tests/test_ote_api.py::test_get_current_15min_interval PASSED            [ 68%]
tests/test_ote_api.py::test_get_15min_price_for_interval PASSED          [ 68%]
tests/test_ote_api.py::test_ote_api_close_noop PASSED                    [ 68%]
tests/test_ote_api.py::test_soap_headers PASSED                          [ 68%]
tests/test_ote_api.py::test_parse_period_interval_dst_suffix PASSED      [ 69%]
tests/test_ote_api.py::test_parse_period_interval_first_occurrence PASSED [ 69%]
tests/test_ote_api.py::test_parse_period_interval_overflow PASSED        [ 69%]
tests/test_ote_api.py::test_aggregate_quarter_to_hour PASSED             [ 69%]
tests/test_ote_api.py::test_is_cache_valid_requires_tomorrow_after_13 PASSED [ 69%]
tests/test_ote_api.py::test_is_cache_valid_missing_today PASSED          [ 69%]
tests/test_ote_api.py::test_cache_helpers PASSED                         [ 69%]
tests/test_ote_api.py::test_cache_helpers_no_path PASSED                 [ 69%]
tests/test_ote_api.py::test_cache_helpers_bad_cache PASSED               [ 69%]
tests/test_ote_api.py::test_async_cache_load_failure PASSED              [ 69%]
tests/test_ote_api.py::test_persist_cache_creates_dir PASSED             [ 69%]
tests/test_ote_api.py::test_persist_cache_sync_error PASSED              [ 69%]
tests/test_ote_api.py::test_async_persist_cache_failure PASSED           [ 69%]
tests/test_ote_api.py::test_format_spot_data_includes_15m_prices PASSED  [ 69%]
tests/test_ote_api.py::test_dam_period_query PASSED                      [ 69%]
tests/test_ote_api.py::test_parse_soap_response_fault PASSED             [ 69%]
tests/test_ote_api.py::test_parse_soap_response_invalid PASSED           [ 69%]
tests/test_ote_api.py::test_parse_soap_response_portal_unavailable PASSED [ 69%]
tests/test_ote_api.py::test_download_rates_validation_error PASSED       [ 69%]
tests/test_ote_api.py::test_download_rates_http_error PASSED             [ 70%]
tests/test_ote_api.py::test_download_rates_success PASSED                [ 70%]
tests/test_ote_api.py::test_get_dam_period_prices_parses PASSED          [ 70%]
tests/test_ote_api.py::test_get_dam_period_prices_skips_invalid PASSED   [ 70%]
tests/test_ote_api.py::test_get_dam_period_prices_missing_elements PASSED [ 70%]
tests/test_ote_api.py::test_cnb_rate_get_day_rates PASSED                [ 70%]
tests/test_ote_api.py::test_cnb_rate_get_day_rates_failure PASSED        [ 70%]
tests/test_ote_api.py::test_cnb_rate_get_current_rates_cache PASSED      [ 70%]
tests/test_ote_api.py::test_cnb_rate_get_current_rates_updates PASSED    [ 70%]
tests/test_ote_api.py::test_get_cnb_exchange_rate PASSED                 [ 70%]
tests/test_ote_api.py::test_get_cnb_exchange_rate_cached PASSED          [ 70%]
tests/test_ote_api.py::test_get_spot_prices_uses_cache PASSED            [ 70%]
tests/test_ote_api.py::test_get_spot_prices_fetch_and_fallback PASSED    [ 70%]
tests/test_ote_api.py::test_get_spot_prices_force_today PASSED           [ 70%]
tests/test_ote_api.py::test_get_spot_prices_after_13 PASSED              [ 70%]
tests/test_ote_api.py::test_get_spot_prices_full_success PASSED          [ 70%]
tests/test_ote_api.py::test_get_spot_prices_fallback_to_cache_on_error PASSED [ 70%]
tests/test_ote_api.py::test_get_spot_prices_error_no_cache PASSED        [ 70%]
tests/test_ote_api.py::test_cnb_rate_retries PASSED                      [ 70%]
tests/test_ote_api.py::test_format_spot_data_empty PASSED                [ 71%]
tests/test_ote_api.py::test_has_data_for_date_helpers PASSED             [ 71%]
tests/test_ote_api.py::test_should_fetch_new_data PASSED                 [ 71%]
tests/test_ote_api.py::test_download_soap_success PASSED                 [ 71%]
tests/test_ote_api.py::test_download_soap_error PASSED                   [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_daily_saves_and_cleans PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_success PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_no_days PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_daily_no_store PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_daily_empty_plan PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_daily_missing_plan PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_daily_save_error PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_no_store PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_cleanup PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_invalid_week_key PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_aggregate_weekly_save_error PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_backfill_daily_archive_from_storage PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_backfill_daily_archive_no_store PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_backfill_daily_archive_no_detailed PASSED [ 71%]
tests/test_plan_storage_aggregate.py::test_backfill_daily_archive_error PASSED [ 72%]
tests/test_plan_storage_aggregate.py::test_backfill_daily_archive_skip_existing PASSED [ 72%]
tests/test_plan_storage_baseline.py::test_is_baseline_plan_invalid PASSED [ 72%]
tests/test_plan_storage_baseline.py::test_create_baseline_plan_with_hybrid_timeline PASSED [ 72%]
tests/test_plan_storage_baseline.py::test_create_baseline_plan_from_storage_fallback PASSED [ 72%]
tests/test_plan_storage_baseline.py::test_ensure_plan_exists PASSED      [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_keeps_existing PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_archives_and_builds PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_baseline_creation PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_baseline_failure PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_baseline_exists PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_missing_mode_result PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_archive_save_error PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_invalid_times PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_missing_attr PASSED [ 72%]
tests/test_plan_storage_daily.py::test_maybe_fix_daily_plan_preserves_actual PASSED [ 72%]
tests/test_planner_min_recovery.py::test_recover_from_below_planning_min_schedules_earliest_ups PASSED [ 72%]
tests/test_planner_min_recovery.py::test_recover_from_below_planning_min_respects_max_ups_price PASSED [ 72%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_with_detail_tabs PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_init_with_entity_category_and_resolve_error PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_normalize_mode_label PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_parse_local_start_none PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_parse_interval_time PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_get_auto_switch_lead_seconds PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_get_auto_switch_lead_seconds_exception PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_no_payload PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_timeline_only PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_detail_tabs_timeline_current PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_detail_tabs_skips_and_breaks PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_detail_tabs_fallback_to_timeline PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_timeline_skips_invalid PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_next_mode_invalid_time PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_next_mode_invalid_time_timeline PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_compute_state_and_attrs_lead_seconds_zero PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_get_forecast_payload_from_coordinator PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_async_refresh_precomputed_payload PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_async_recompute_sets_state PASSED [ 73%]
tests/test_planner_recommended_sensor.py::test_async_recompute_writes_state PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_recompute_no_change PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_recompute_handles_exception PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_available_and_extra_attrs PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_added_to_hass_setup_and_recompute PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_added_to_hass_triggers_callbacks PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_added_to_hass_handles_errors PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_async_will_remove_from_hass PASSED [ 74%]
tests/test_planner_recommended_sensor.py::test_handle_coordinator_update PASSED [ 74%]
tests/test_planner_timeline.py::test_build_planner_timeline PASSED       [ 74%]
tests/test_planner_timeline.py::test_build_planner_timeline_breaks PASSED [ 74%]
tests/test_planner_timeline.py::test_format_planner_reason PASSED        [ 74%]
tests/test_planner_timeline.py::test_attach_planner_reasons PASSED       [ 74%]
tests/test_planner_timeline.py::test_add_decision_reasons_to_timeline PASSED [ 74%]
tests/test_planner_timeline.py::test_add_decision_reasons_to_timeline_branches PASSED [ 74%]
tests/test_planner_timeline.py::test_add_decision_reasons_empty_timeline PASSED [ 74%]
tests/test_planning_api.py::test_active_plan_missing_system PASSED       [ 74%]
tests/test_planning_api.py::test_active_plan_none PASSED                 [ 74%]
tests/test_planning_api.py::test_active_plan_success PASSED              [ 74%]
tests/test_planning_api.py::test_active_plan_error PASSED                [ 75%]
tests/test_planning_api.py::test_plan_list_success PASSED                [ 75%]
tests/test_planning_api.py::test_plan_list_invalid_filter PASSED         [ 75%]
tests/test_planning_api.py::test_plan_list_missing_system PASSED         [ 75%]
tests/test_planning_api.py::test_plan_detail_not_found PASSED            [ 75%]
tests/test_planning_api.py::test_plan_detail_missing_system PASSED       [ 75%]
tests/test_planning_api.py::test_plan_detail_error PASSED                [ 75%]
tests/test_planning_api.py::test_plan_detail_success PASSED              [ 75%]
tests/test_planning_api.py::test_create_manual_plan_missing_fields PASSED [ 75%]
tests/test_planning_api.py::test_create_manual_plan_missing_system PASSED [ 75%]
tests/test_planning_api.py::test_create_manual_plan_success PASSED       [ 75%]
tests/test_planning_api.py::test_create_manual_plan_error PASSED         [ 75%]
tests/test_planning_api.py::test_activate_plan_missing_system PASSED     [ 75%]
tests/test_planning_api.py::test_deactivate_plan_missing_system PASSED   [ 75%]
tests/test_planning_api.py::test_activate_deactivate_plan PASSED         [ 75%]
tests/test_planning_api.py::test_activate_deactivate_plan_error PASSED   [ 75%]
tests/test_planning_api.py::test_setup_planning_api_views PASSED         [ 75%]
tests/test_planning_auto_switch.py::test_auto_mode_switch_enabled PASSED [ 75%]
tests/test_planning_auto_switch.py::test_normalize_service_mode PASSED   [ 75%]
tests/test_planning_auto_switch.py::test_get_planned_mode_for_time PASSED [ 76%]
tests/test_planning_auto_switch.py::test_cancel_auto_switch_schedule_clears_handles PASSED [ 76%]
tests/test_planning_auto_switch.py::test_schedule_auto_switch_retry_sets_unsub PASSED [ 76%]
tests/test_planning_auto_switch.py::test_get_current_box_mode PASSED     [ 76%]
tests/test_planning_auto_switch.py::test_cancel_auto_switch_schedule_handles_errors PASSED [ 76%]
tests/test_planning_auto_switch.py::test_clear_auto_switch_retry_handles_error PASSED [ 76%]
tests/test_planning_auto_switch.py::test_start_stop_watchdog PASSED      [ 76%]
tests/test_planning_auto_switch.py::test_auto_switch_watchdog_tick PASSED [ 76%]
tests/test_planning_auto_switch.py::test_get_planned_mode_for_time_invalid PASSED [ 76%]
tests/test_planning_auto_switch.py::test_schedule_auto_switch_retry_skip PASSED [ 76%]
tests/test_planning_auto_switch.py::test_get_mode_switch_offset PASSED   [ 76%]
tests/test_planning_auto_switch.py::test_get_service_shield PASSED       [ 76%]
tests/test_planning_auto_switch.py::test_execute_mode_change_branches PASSED [ 76%]
tests/test_planning_auto_switch.py::test_ensure_current_mode PASSED      [ 76%]
tests/test_planning_auto_switch.py::test_get_mode_switch_timeline PASSED [ 76%]
tests/test_planning_auto_switch.py::test_update_auto_switch_schedule PASSED [ 76%]
tests/test_planning_auto_switch.py::test_start_watchdog_ticks PASSED     [ 76%]
tests/test_planning_auto_switch.py::test_update_auto_switch_schedule_adjusts_past PASSED [ 76%]
tests/test_planning_auto_switch.py::test_calculate_interval_cost_opportunity PASSED [ 76%]
tests/test_planning_auto_switch.py::test_calculate_fixed_mode_cost_basic PASSED [ 77%]
tests/test_planning_auto_switch.py::test_calculate_mode_baselines PASSED [ 77%]
tests/test_planning_helpers.py::test_enforce_min_mode_duration_replaces_short_block PASSED [ 77%]
tests/test_planning_helpers.py::test_get_mode_guard_context_active PASSED [ 77%]
tests/test_planning_helpers.py::test_build_plan_lock PASSED              [ 77%]
tests/test_planning_helpers.py::test_apply_mode_guard_lock_and_exception PASSED [ 77%]
tests/test_planning_helpers.py::test_apply_guard_reasons_to_timeline PASSED [ 77%]
tests/test_planning_helpers.py::test_get_candidate_intervals_filters_and_sorts PASSED [ 77%]
tests/test_planning_helpers.py::test_simulate_forward_death_valley PASSED [ 77%]
tests/test_planning_helpers.py::test_calculate_minimum_charge_and_protection PASSED [ 77%]
tests/test_planning_helpers.py::test_recalculate_timeline_from_index_updates_soc_and_mode PASSED [ 77%]
tests/test_planning_helpers.py::test_fix_minimum_capacity_violations_and_target_capacity PASSED [ 77%]
tests/test_planning_helpers.py::test_group_intervals_by_mode_completed_and_planned PASSED [ 77%]
tests/test_planning_helpers.py::test_create_mode_recommendations_split_midnight PASSED [ 77%]
tests/test_planning_helpers.py::test_charging_helpers_store_metrics PASSED [ 77%]
tests/test_planning_helpers.py::test_economic_charging_plan_death_valley PASSED [ 77%]
tests/test_planning_helpers.py::test_smart_charging_plan_adds_charge PASSED [ 77%]
tests/test_precompute.py::test_precompute_ui_data_missing_store PASSED   [ 77%]
tests/test_precompute.py::test_precompute_ui_data_success PASSED         [ 77%]
tests/test_precompute.py::test_schedule_precompute_throttle PASSED       [ 78%]
tests/test_precompute.py::test_schedule_precompute_creates_task PASSED   [ 78%]
tests/test_precompute_unified_tile.py::test_precompute_ui_data_saves_payload PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_precompute_ui_data_skips_without_store PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_precompute_ui_data_handles_detail_tabs_error PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_schedule_precompute_skips_recent PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_schedule_precompute_skips_running PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_schedule_precompute_creates_task PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_build_unified_cost_tile_success PASSED [ 78%]
tests/test_precompute_unified_tile.py::test_build_unified_cost_tile_handles_error PASSED [ 78%]
tests/test_presentation_helpers.py::test_build_extra_state_attributes PASSED [ 78%]
tests/test_presentation_helpers.py::test_calculate_data_hash PASSED      [ 78%]
tests/test_presentation_helpers.py::test_build_baseline_comparison PASSED [ 78%]
tests/test_presentation_helpers.py::test_analyze_today_variance_text PASSED [ 78%]
tests/test_presentation_helpers.py::test_analyze_yesterday_performance PASSED [ 78%]
tests/test_presentation_helpers.py::test_decorate_plan_tabs_adds_metadata_and_comparison PASSED [ 78%]
tests/test_presentation_helpers.py::test_build_hybrid_detail_tabs_empty PASSED [ 78%]
tests/test_pricing_fixed_prices.py::test_calculate_final_spot_price_fixed_prices PASSED [ 78%]
tests/test_pricing_fixed_prices.py::test_get_spot_price_timeline_fixed_prices PASSED [ 78%]
tests/test_pricing_helpers.py::test_round_czk PASSED                     [ 79%]
tests/test_pricing_helpers.py::test_calculate_commercial_price_percentage PASSED [ 79%]
tests/test_pricing_helpers.py::test_calculate_commercial_price_fixed_prices PASSED [ 79%]
tests/test_pricing_helpers.py::test_calculate_commercial_price_fixed_fee PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_distribution_fee PASSED          [ 79%]
tests/test_pricing_helpers.py::test_resolve_spot_data_fallbacks PASSED   [ 79%]
tests/test_pricing_helpers.py::test_get_prices_dict_and_resolve PASSED   [ 79%]
tests/test_pricing_helpers.py::test_resolve_prices_dict_uses_cache PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_export_config PASSED             [ 79%]
tests/test_pricing_helpers.py::test_get_sensor_component_and_find_entity PASSED [ 79%]
tests/test_pricing_helpers.py::test_derive_export_prices PASSED          [ 79%]
tests/test_pricing_helpers.py::test_get_spot_price_timeline_invalid_timestamp PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_spot_price_timeline_missing_data PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_spot_price_timeline_missing_prices PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_export_price_timeline_derives PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_export_price_timeline_no_spot PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_export_price_timeline_missing_prices PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_export_price_timeline_invalid_timestamp PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_spot_data_from_price_sensor PASSED [ 79%]
tests/test_pricing_helpers.py::test_get_spot_data_from_price_sensor_exception PASSED [ 80%]
tests/test_pricing_helpers.py::test_get_spot_data_from_ote_cache PASSED  [ 80%]
tests/test_pricing_helpers.py::test_get_spot_data_from_ote_cache_no_hass PASSED [ 80%]
tests/test_pricing_helpers.py::test_get_spot_data_from_ote_cache_exception PASSED [ 80%]
tests/test_pricing_more.py::test_round_czk_half_up PASSED                [ 80%]
tests/test_pricing_more.py::test_calculate_commercial_price_percentage_and_fixed PASSED [ 80%]
tests/test_pricing_more.py::test_get_distribution_fee_vt_nt PASSED       [ 80%]
tests/test_pricing_more.py::test_get_spot_price_timeline_invalid_timestamp PASSED [ 80%]
tests/test_pricing_more.py::test_get_export_price_timeline_direct_and_derived PASSED [ 80%]
tests/test_pricing_more.py::test_get_spot_data_from_price_sensor_component_entity PASSED [ 80%]
tests/test_pricing_more.py::test_get_spot_data_from_price_sensor_component_entities_list PASSED [ 80%]
tests/test_pricing_more.py::test_get_spot_data_from_price_sensor_missing PASSED [ 80%]
tests/test_pricing_more.py::test_get_spot_data_from_ote_cache_error PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_tariff_parsing_and_calculation_percentage PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_tariff_fixed_prices_and_fee PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_calculate_attributes_and_state PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_handle_coordinator_update PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_handle_coordinator_update_error PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_async_added_to_hass_initial_fetch PASSED [ 80%]
tests/test_pricing_spot_price_15min.py::test_async_added_to_hass_initial_fetch_error PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_restore_data_valid PASSED   [ 81%]
tests/test_pricing_spot_price_15min.py::test_restore_data_invalid PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_setup_daily_tracking PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_setup_15min_tracking PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_async_will_remove_cleans_tracking PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_update_current_interval_triggers_refresh PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_do_fetch_15min_spot_data PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_do_fetch_15min_spot_data_error PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_current_state_no_data PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_current_state_no_price PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_current_state_exception PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_attributes_no_data PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_attributes_invalid_interval PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_attributes_rollover PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_calculate_attributes_error PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_get_tariff_for_datetime_weekend PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_parse_tariff_times_invalid PASSED [ 81%]
tests/test_pricing_spot_price_15min.py::test_fetch_with_retry_schedules PASSED [ 82%]
tests/test_pricing_spot_price_15min.py::test_fetch_with_retry_success PASSED [ 82%]
tests/test_pricing_spot_price_15min.py::test_cancel_retry_timer PASSED   [ 82%]
tests/test_pricing_spot_price_15min.py::test_schedule_retry_executes PASSED [ 82%]
tests/test_pricing_spot_price_15min.py::test_properties PASSED           [ 82%]
tests/test_pricing_spot_price_15min.py::test_properties_compute_without_cache PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_export_price_calculation PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_export_attributes_and_state PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_handle_coordinator_update PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_handle_coordinator_update_error PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_async_added_to_hass_initial_fetch PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_async_added_to_hass_initial_fetch_error PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_restore_data_valid PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_setup_daily_tracking PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_setup_15min_tracking PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_update_current_interval_triggers_refresh PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_do_fetch_15min_data PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_do_fetch_15min_data_error PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_current_state_no_data PASSED [ 82%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_current_state_no_price PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_current_state_exception PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_attributes_empty PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_attributes_invalid_interval PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_attributes_rollover PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_calculate_attributes_error PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_fetch_with_retry_schedules PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_fetch_with_retry_success PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_restore_data_invalid PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_async_will_remove_from_hass PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_cancel_retry_timer PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_schedule_retry_executes PASSED [ 83%]
tests/test_pricing_spot_price_export_15min.py::test_properties PASSED    [ 83%]
tests/test_pricing_spot_price_hourly.py::test_validate_spot_data PASSED  [ 83%]
tests/test_pricing_spot_price_hourly.py::test_current_price_and_attributes PASSED [ 83%]
tests/test_pricing_spot_price_hourly.py::test_all_hourly_prices PASSED   [ 83%]
tests/test_pricing_spot_price_hourly.py::test_handle_coordinator_update PASSED [ 83%]
tests/test_pricing_spot_price_hourly.py::test_handle_coordinator_update_no_data PASSED [ 83%]
tests/test_pricing_spot_price_hourly.py::test_async_added_to_hass_initial_fetch PASSED [ 83%]
tests/test_pricing_spot_price_hourly.py::test_async_added_to_hass_fetch_error PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_restore_data_invalid_timestamp PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_restore_data_valid_timestamp PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_do_fetch_spot_data_paths PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_do_fetch_spot_data_invalid PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_do_fetch_spot_data_error PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_state_branches PASSED      [ 84%]
tests/test_pricing_spot_price_hourly.py::test_hourly_prices_empty PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_validate_spot_data_empty PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_validate_spot_data_missing_prices PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_validate_spot_data_too_few_hours PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_validate_spot_data_invalid_prices PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_setup_time_tracking_after_daily PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_get_helpers_missing_data PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_fetch_spot_data_legacy PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_retry_timer_cancel PASSED  [ 84%]
tests/test_pricing_spot_price_hourly.py::test_schedule_retry_executes PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_restore_data_invalid PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_fetch_with_retry_schedules PASSED [ 84%]
tests/test_pricing_spot_price_hourly.py::test_fetch_with_retry_success PASSED [ 85%]
tests/test_pricing_spot_price_hourly.py::test_async_will_remove_from_hass PASSED [ 85%]
tests/test_pricing_spot_price_hourly.py::test_properties PASSED          [ 85%]
tests/test_pricing_spot_price_hourly.py::test_get_hourly_prices_rollover PASSED [ 85%]
tests/test_pricing_spot_price_hourly.py::test_get_all_hourly_prices_empty_prices PASSED [ 85%]
tests/test_pricing_spot_price_hourly.py::test_async_update PASSED        [ 85%]
tests/test_pricing_spot_price_hourly.py::test_spot_price_shared_helpers PASSED [ 85%]
tests/test_pricing_spot_price_sensor.py::test_spot_price_sensor_exports PASSED [ 85%]
tests/test_scenario_analysis.py::test_simulate_interval_uses_planning_min PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_interval_cost_opportunity PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_fixed_mode_cost_with_penalty PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_fixed_mode_cost_bad_timestamp PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_mode_baselines PASSED    [ 85%]
tests/test_scenario_analysis.py::test_calculate_mode_baselines_with_penalty PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_do_nothing_cost PASSED   [ 85%]
tests/test_scenario_analysis.py::test_calculate_do_nothing_cost_bad_timestamp PASSED [ 85%]
tests/test_scenario_analysis.py::test_calculate_full_ups_cost PASSED     [ 85%]
tests/test_scenario_analysis.py::test_calculate_full_ups_cost_bad_timestamp PASSED [ 85%]
tests/test_scenario_analysis.py::test_generate_alternatives PASSED       [ 85%]
tests/test_scenario_analysis.py::test_generate_alternatives_bad_timestamp PASSED [ 86%]
tests/test_scenario_analysis.py::test_generate_alternatives_branches PASSED [ 86%]
tests/test_sensor_cleanup_extra.py::test_get_device_info_for_sensor PASSED [ 86%]
tests/test_sensor_cleanup_extra.py::test_cleanup_removed_devices PASSED  [ 86%]
tests/test_sensor_cleanup_extra.py::test_cleanup_empty_devices_internal PASSED [ 86%]
tests/test_sensor_cleanup_extra.py::test_cleanup_all_orphaned_entities PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_import_errors_cover_branches PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_get_expected_sensor_types PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_cleanup_helpers PASSED          [ 86%]
tests/test_sensor_full_coverage.py::test_cleanup_renamed_sensors_parts_after_empty PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_cover_unreachable_line_152 PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_cleanup_all_orphaned_entities PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_get_device_info_for_sensor PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_full PASSED   [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_disabled_branches PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_len_exception PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_title_parsing PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_setattr_failure PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_data_source_error PASSED [ 86%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_basic_sensor_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_data_none_branches PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_extended_errors PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_statistics_empty PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_solar_import_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_battery_exceptions PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_pricing_errors PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_pricing_import_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_chmu_import_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_boiler_import_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_extended_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_statistics_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_solar_exception PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_battery_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_battery_no_sensors PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_pricing_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_chmu_empty_and_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_chmu_init_error PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_boiler_exception PASSED [ 87%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_misc_branches PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_battery_import_error PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_solar_no_sensors PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_boiler_empty PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_async_setup_entry_boiler_missing_coordinator PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_async_unload_entry_and_cleanup PASSED [ 88%]
tests/test_sensor_full_coverage.py::test_cleanup_empty_devices PASSED    [ 88%]
tests/test_sensor_lifecycle.py::test_async_added_to_hass_restores_and_schedules PASSED [ 88%]
tests/test_sensor_lifecycle.py::test_async_added_to_hass_restore_state_failures PASSED [ 88%]
tests/test_sensor_lifecycle.py::test_async_added_to_hass_callbacks PASSED [ 88%]
tests/test_sensor_lifecycle.py::test_async_added_to_hass_store_failures PASSED [ 88%]
tests/test_sensor_lifecycle.py::test_async_added_to_hass_initial_refresh_error PASSED [ 88%]
tests/test_sensor_registry_cleanup.py::test_get_expected_sensor_types PASSED [ 88%]
tests/test_sensor_registry_cleanup.py::test_cleanup_renamed_sensors PASSED [ 88%]
tests/test_sensor_setup_entry.py::test_sensor_async_setup_entry PASSED   [ 88%]
tests/test_sensor_setup_entry.py::test_sensor_async_setup_entry_from_title PASSED [ 88%]
tests/test_sensor_setup_entry.py::test_sensor_async_setup_entry_no_box_id PASSED [ 88%]
tests/test_sensor_setup_runtime.py::test_initialize_sensor_sets_defaults PASSED [ 88%]
tests/test_sensor_setup_runtime.py::test_log_rate_limited PASSED         [ 88%]
tests/test_sensor_setup_runtime.py::test_get_state_and_availability PASSED [ 89%]
tests/test_services_box_id.py::test_get_box_id_from_entry_option PASSED  [ 89%]
tests/test_services_box_id.py::test_get_box_id_from_coordinator_data PASSED [ 89%]
tests/test_services_box_id.py::test_get_box_id_from_device_identifier PASSED [ 89%]
tests/test_services_box_id.py::test_get_box_id_device_missing PASSED     [ 89%]
tests/test_services_box_id.py::test_get_box_id_from_entry_data_inverter_sn PASSED [ 89%]
tests/test_services_box_id.py::test_get_box_id_from_device_identifier_missing_domain PASSED [ 89%]
tests/test_services_box_id.py::test_get_box_id_none_when_unavailable PASSED [ 89%]
tests/test_services_full_coverage.py::test_get_box_id_from_device_entry_and_coordinator PASSED [ 89%]
tests/test_services_full_coverage.py::test_get_box_id_from_device_exceptions PASSED [ 89%]
tests/test_services_full_coverage.py::test_get_box_id_from_device_registry PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_services_extra_paths PASSED [ 89%]
tests/test_services_full_coverage.py::test_check_balancing_paths PASSED  [ 89%]
tests/test_services_full_coverage.py::test_check_balancing_requested_box_skip PASSED [ 89%]
tests/test_services_full_coverage.py::test_check_balancing_no_plan PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_with_shield PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_with_shield_none PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_with_shield_errors PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_with_shield_boiler_error PASSED [ 89%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_fallback PASSED [ 90%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_fallback_registration_error PASSED [ 90%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_fallback_missing_box_id PASSED [ 90%]
tests/test_services_full_coverage.py::test_async_setup_entry_services_switch_paths PASSED [ 90%]
tests/test_services_full_coverage.py::test_async_unload_services PASSED  [ 90%]
tests/test_services_setup.py::test_async_setup_services_dashboard_tiles PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_update_solar PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_check_balancing_no_entries PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_save_tiles_invalid_json PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_save_tiles_missing_keys PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_get_tiles_none PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_services_check_balancing_success_and_error PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_entry_services_fallback_calls_api PASSED [ 90%]
tests/test_services_setup.py::test_async_setup_entry_services_with_shield_calls_intercept PASSED [ 90%]
tests/test_shared_logging.py::test_send_event_success PASSED             [ 90%]
tests/test_shared_logging.py::test_send_event_failure PASSED             [ 90%]
tests/test_shared_logging.py::test_send_event_exception PASSED           [ 90%]
tests/test_shared_logging.py::test_get_session_reuses_connector PASSED   [ 90%]
tests/test_shared_logging.py::test_get_session_recreates_when_closed PASSED [ 91%]
tests/test_shared_logging.py::test_close_session PASSED                  [ 91%]
tests/test_shared_logging.py::test_setup_simple_telemetry PASSED         [ 91%]
tests/test_shared_logging.py::test_setup_simple_telemetry_error PASSED   [ 91%]
tests/test_shield_core.py::test_start_resets_and_schedules PASSED        [ 91%]
tests/test_shield_core.py::test_setup_state_listener_empty_pending PASSED [ 91%]
tests/test_shield_core.py::test_setup_state_listener_with_pending PASSED [ 91%]
tests/test_shield_core.py::test_on_entity_state_changed_triggers_check PASSED [ 91%]
tests/test_shield_core.py::test_notify_state_change_handles_callbacks PASSED [ 91%]
tests/test_shield_core.py::test_wrapper_methods PASSED                   [ 91%]
tests/test_shield_core.py::test_setup_telemetry_initializes_handler PASSED [ 91%]
tests/test_shield_core.py::test_extract_expected_entities_formating_mode_fake_entity PASSED [ 91%]
tests/test_shield_core.py::test_extract_expected_entities_box_mode_mismatch PASSED [ 91%]
tests/test_shield_core.py::test_extract_expected_entities_boiler_mode_mapping PASSED [ 91%]
tests/test_shield_core.py::test_extract_expected_entities_grid_delivery_limit_only PASSED [ 91%]
tests/test_shield_core.py::test_extract_expected_entities_grid_delivery_mode_only PASSED [ 91%]
tests/test_shield_core.py::test_check_entity_state_change_variants PASSED [ 91%]
tests/test_shield_core.py::test_log_event_uses_main_entity_for_limit PASSED [ 91%]
tests/test_shield_core.py::test_log_telemetry_sends_event PASSED         [ 91%]
tests/test_shield_core.py::test_register_services PASSED                 [ 92%]
tests/test_shield_core.py::test_handle_remove_from_queue PASSED          [ 92%]
tests/test_shield_core.py::test_shield_status_and_queue_info PASSED      [ 92%]
tests/test_shield_core.py::test_check_loop_timeout_formating_mode PASSED [ 92%]
tests/test_shield_core.py::test_check_loop_clears_listener_when_idle PASSED [ 92%]
tests/test_shield_core.py::test_extract_expected_entities_box_mode_changes PASSED [ 92%]
tests/test_shield_core.py::test_extract_expected_entities_box_mode_no_change PASSED [ 92%]
tests/test_shield_core.py::test_extract_expected_entities_boiler_mode PASSED [ 92%]
tests/test_shield_core.py::test_extract_expected_entities_grid_delivery_mode_limit_rejected PASSED [ 92%]
tests/test_shield_core.py::test_extract_expected_entities_formating_mode PASSED [ 92%]
tests/test_shield_core.py::test_check_entity_state_change_boiler_and_ssr PASSED [ 92%]
tests/test_shield_core.py::test_check_entity_state_change_grid_mode_binary_sensor PASSED [ 92%]
tests/test_shield_core.py::test_check_entity_state_change_box_mode_numeric PASSED [ 92%]
tests/test_shield_core.py::test_check_entity_state_change_grid_limit_numeric PASSED [ 92%]
tests/test_shield_core.py::test_check_loop_completes_and_starts_queue PASSED [ 92%]
tests/test_shield_core.py::test_check_loop_power_monitor_completion PASSED [ 92%]
tests/test_shield_core.py::test_safe_call_service_boiler_mode PASSED     [ 92%]
tests/test_shield_core.py::test_safe_call_service_entity_mode PASSED     [ 92%]
tests/test_shield_core.py::test_check_entities_periodically_success PASSED [ 92%]
tests/test_shield_core.py::test_mode_transition_tracker_records_transition PASSED [ 93%]
tests/test_shield_core.py::test_mode_transition_tracker_offset_fallback PASSED [ 93%]
tests/test_shield_core_more.py::test_notify_state_change_with_coroutine PASSED [ 93%]
tests/test_shield_core_more.py::test_setup_state_listener_collects_entities PASSED [ 93%]
tests/test_shield_core_more.py::test_on_entity_state_changed_schedules PASSED [ 93%]
tests/test_shield_core_more.py::test_mode_tracker_stats_and_offset PASSED [ 93%]
tests/test_shield_core_more.py::test_mode_tracker_load_history PASSED    [ 93%]
tests/test_shield_core_more2.py::test_setup_telemetry_failure PASSED     [ 93%]
tests/test_shield_core_more2.py::test_setup_state_listener_without_pending PASSED [ 93%]
tests/test_shield_core_more3.py::test_log_security_event_with_handler PASSED [ 93%]
tests/test_shield_core_more3.py::test_notify_state_change_handles_exception PASSED [ 93%]
tests/test_shield_dispatch.py::test_intercept_splits_grid_delivery PASSED [ 93%]
tests/test_shield_dispatch.py::test_intercept_skips_when_no_expected PASSED [ 93%]
tests/test_shield_dispatch.py::test_intercept_dedup_queue PASSED         [ 93%]
tests/test_shield_dispatch.py::test_intercept_already_matching_entities PASSED [ 93%]
tests/test_shield_dispatch.py::test_intercept_queue_when_running PASSED  [ 93%]
tests/test_shield_dispatch.py::test_start_call_records_pending PASSED    [ 93%]
tests/test_shield_dispatch.py::test_safe_call_service_boiler_mode PASSED [ 93%]
tests/test_shield_dispatch_more.py::test_intercept_service_call_skips_when_no_expected PASSED [ 93%]
tests/test_shield_dispatch_more.py::test_intercept_service_call_dedup_queue PASSED [ 94%]
tests/test_shield_dispatch_more.py::test_start_call_records_pending PASSED [ 94%]
tests/test_shield_dispatch_more.py::test_log_event_branches PASSED       [ 94%]
tests/test_shield_dispatch_more2.py::test_intercept_service_skips_when_no_expected PASSED [ 94%]
tests/test_shield_dispatch_more2.py::test_intercept_service_duplicate_in_queue PASSED [ 94%]
tests/test_shield_dispatch_more2.py::test_intercept_service_all_ok_skips PASSED [ 94%]
tests/test_shield_dispatch_more3.py::test_start_call_power_monitor PASSED [ 94%]
tests/test_shield_dispatch_more3.py::test_safe_call_service_boiler_mode PASSED [ 94%]
tests/test_shield_dispatch_more4.py::test_safe_call_service_error PASSED [ 94%]
tests/test_shield_queue.py::test_handle_remove_from_queue PASSED         [ 94%]
tests/test_shield_queue.py::test_has_pending_mode_change PASSED          [ 94%]
tests/test_shield_queue.py::test_check_loop_empty_cleans_listener PASSED [ 94%]
tests/test_shield_queue.py::test_handle_remove_from_queue_invalid_position PASSED [ 94%]
tests/test_shield_queue.py::test_handle_remove_from_queue_running_position PASSED [ 94%]
tests/test_shield_queue.py::test_handle_remove_from_queue_queue_index_error PASSED [ 94%]
tests/test_shield_queue.py::test_check_loop_skips_when_already_running PASSED [ 94%]
tests/test_shield_queue.py::test_check_loop_power_monitor_completion PASSED [ 94%]
tests/test_shield_queue.py::test_check_loop_all_ok_starts_next_call PASSED [ 94%]
tests/test_shield_queue.py::test_start_monitoring_creates_task PASSED    [ 94%]
tests/test_shield_queue.py::test_start_monitoring_skips_when_running PASSED [ 95%]
tests/test_shield_queue.py::test_check_entities_periodically_success PASSED [ 95%]
tests/test_shield_queue.py::test_check_entities_periodically_timeout PASSED [ 95%]
tests/test_shield_queue.py::test_async_check_loop_error_path PASSED      [ 95%]
tests/test_shield_queue_more.py::test_get_shield_status_and_queue_info PASSED [ 95%]
tests/test_shield_queue_more.py::test_has_pending_mode_change PASSED     [ 95%]
tests/test_shield_queue_more.py::test_handle_remove_from_queue_invalid_position PASSED [ 95%]
tests/test_shield_queue_more.py::test_check_loop_timeout_completion PASSED [ 95%]
tests/test_shield_queue_more2.py::test_handle_remove_from_queue_invalid_position PASSED [ 95%]
tests/test_shield_queue_more2.py::test_get_shield_status_and_queue_info PASSED [ 95%]
tests/test_shield_queue_more2.py::test_has_pending_mode_change_target PASSED [ 95%]
tests/test_shield_queue_more3.py::test_check_loop_clears_listener_when_empty PASSED [ 95%]
tests/test_shield_queue_more3.py::test_check_loop_timeout_formating_mode PASSED [ 95%]
tests/test_shield_queue_more4.py::test_handle_remove_from_queue_running_position PASSED [ 95%]
tests/test_shield_queue_more4.py::test_handle_remove_from_queue_index_error PASSED [ 95%]
tests/test_shield_queue_more4.py::test_has_pending_mode_change_running PASSED [ 95%]
tests/test_shield_validation.py::test_normalize_value_and_values_match PASSED [ 95%]
tests/test_shield_validation.py::test_extract_api_info PASSED            [ 95%]
tests/test_shield_validation.py::test_extract_expected_entities_box_mode PASSED [ 95%]
tests/test_shield_validation.py::test_extract_expected_entities_formating PASSED [ 96%]
tests/test_shield_validation_more.py::test_extract_api_info_grid_delivery PASSED [ 96%]
tests/test_shield_validation_more.py::test_extract_expected_entities_box_mode_resolve PASSED [ 96%]
tests/test_shield_validation_more.py::test_extract_expected_entities_formating_mode PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEI::test_day_surplus_charges_battery PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEI::test_day_surplus_battery_full_exports PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEI::test_day_deficit_discharges_battery PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEI::test_day_deficit_battery_at_hw_min_uses_grid PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEI::test_night_discharges_to_hw_min PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEII::test_day_surplus_charges_battery PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEII::test_day_deficit_NETOUCHED_uses_grid PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEII::test_night_identical_to_home_i PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEIII::test_day_all_solar_to_battery PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEIII::test_day_battery_full_exports_surplus PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEIII::test_day_no_solar_grid_only PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEIII::test_night_identical_to_home_i PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEUPS::test_charges_from_solar_unlimited PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEUPS::test_charges_from_grid_limited_2_8kw PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEUPS::test_charges_from_solar_and_grid PASSED [ 96%]
tests/test_simulate_interval_new.py::TestHOMEUPS::test_battery_full_exports_solar PASSED [ 97%]
tests/test_simulate_interval_new.py::TestNightOptimization::test_all_modes_identical_at_night PASSED [ 97%]
tests/test_simulate_interval_new.py::TestNightOptimization::test_night_optimization_respects_hw_min PASSED [ 97%]
tests/test_simulate_interval_new.py::TestEdgeCases::test_invalid_mode_raises_error PASSED [ 97%]
tests/test_simulate_interval_new.py::TestEdgeCases::test_zero_solar_zero_load PASSED [ 97%]
tests/test_simulate_interval_new.py::TestEdgeCases::test_efficiency_applied_correctly PASSED [ 97%]
tests/test_simulate_interval_new.py::TestEdgeCases::test_net_cost_calculation PASSED [ 97%]
tests/test_simulate_interval_new.py::TestRealWorldScenarios::test_sunny_day_home_i PASSED [ 97%]
tests/test_simulate_interval_new.py::TestRealWorldScenarios::test_cloudy_day_home_ii_saves_battery PASSED [ 97%]
tests/test_simulate_interval_new.py::TestRealWorldScenarios::test_home_iii_aggressive_charging PASSED [ 97%]
tests/test_simulate_interval_new.py::TestRealWorldScenarios::test_home_ups_charges_to_100_percent PASSED [ 97%]
tests/test_solar_forecast_more.py::test_get_solar_forecast_no_hass PASSED [ 97%]
tests/test_solar_forecast_more.py::test_get_solar_forecast_disabled PASSED [ 97%]
tests/test_solar_forecast_more.py::test_get_solar_forecast_missing_state_with_cache PASSED [ 97%]
tests/test_solar_forecast_more.py::test_get_solar_forecast_no_attrs PASSED [ 97%]
tests/test_solar_forecast_more.py::test_get_solar_forecast_strings_missing PASSED [ 97%]
tests/test_task_and_storage.py::test_create_task_threadsafe_same_loop PASSED [ 97%]
tests/test_task_and_storage.py::test_create_task_threadsafe_other_loop PASSED [ 97%]
tests/test_task_and_storage.py::test_schedule_forecast_retry PASSED      [ 97%]
tests/test_task_and_storage.py::test_save_and_load_plan_storage PASSED   [ 98%]
tests/test_task_and_storage.py::test_save_plan_storage_failure_creates_cache PASSED [ 98%]
tests/test_task_and_storage.py::test_save_plan_storage_creates_cache_attr PASSED [ 98%]
tests/test_task_and_storage.py::test_save_plan_storage_no_store PASSED   [ 98%]
tests/test_task_and_storage.py::test_save_plan_storage_failure_with_retry PASSED [ 98%]
tests/test_task_and_storage.py::test_load_plan_storage_empty_and_missing_plan PASSED [ 98%]
tests/test_task_and_storage.py::test_load_plan_storage_error_fallback PASSED [ 98%]
tests/test_task_and_storage.py::test_plan_exists_in_storage PASSED       [ 98%]
tests/test_task_and_storage.py::test_load_plan_storage_fallback_cache PASSED [ 98%]
tests/test_task_and_storage.py::test_load_plan_storage_no_cache PASSED   [ 98%]
tests/test_telemetry_store.py::test_set_cloud_payload_adds_box_id PASSED [ 98%]
tests/test_telemetry_store.py::test_apply_local_events_updates_payload PASSED [ 98%]
tests/test_telemetry_store.py::test_seed_from_existing_local_states PASSED [ 98%]
tests/test_timeline_extended.py::test_build_day_timeline_historical_with_storage PASSED [ 98%]
tests/test_timeline_extended.py::test_build_day_timeline_mixed_rebuild PASSED [ 98%]
tests/test_timeline_extended.py::test_build_day_timeline_planned_only PASSED [ 98%]
tests/test_timeline_extended_more.py::test_build_timeline_extended_storage_error PASSED [ 98%]
tests/test_timeline_extended_more.py::test_build_day_timeline_historical_only PASSED [ 98%]
tests/test_timeline_extended_more.py::test_build_day_timeline_mixed_with_repair PASSED [ 98%]
tests/test_timeline_extended_more.py::test_build_day_timeline_planned_only PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_build_baseline_comparison_selects_best PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_analyze_today_variance_no_completed PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_analyze_today_variance_with_diffs PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_analyze_yesterday_performance_and_tomorrow_plan PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_build_today_cost_data PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_resolve_interval_cost_uses_net_cost PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_resolve_interval_cost_fallback_computation PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_build_tomorrow_cost_data PASSED [ 99%]
tests/test_unified_cost_tile_helpers.py::test_get_yesterday_cost_from_archive PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more.py::test_analyze_today_variance_no_completed PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more.py::test_analyze_today_variance_diffs PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more.py::test_analyze_yesterday_performance_no_data PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more.py::test_analyze_yesterday_performance_empty_intervals PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more2.py::test_resolve_interval_cost_fallback_computed PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more2.py::test_resolve_interval_cost_invalid_payload PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more2.py::test_get_yesterday_cost_from_archive_empty PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more2.py::test_get_yesterday_cost_from_archive_with_data PASSED [ 99%]
tests/test_unified_cost_tile_helpers_more3.py::test_build_today_cost_data_active_interval PASSED [100%]

=============================== warnings summary ===============================
tests/test_adaptive_load_profiles_sensor_more.py::test_find_best_matching_profile_paths
  /Users/martinhorak/Downloads/oig_cloud/venv/lib/python3.13/site-packages/numpy/lib/_function_base_impl.py:3065: RuntimeWarning: invalid value encountered in divide
    c /= stddev[:, None]

tests/test_entities_computed_sensor.py::test_energy_store_load_and_save
tests/test_entities_computed_sensor_more3.py::test_save_energy_to_storage_forced
tests/test_entities_computed_sensor_more3.py::test_save_energy_to_storage_error
  /Users/martinhorak/Downloads/oig_cloud/custom_components/oig_cloud/entities/computed_sensor.py:174: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

tests/test_entities_computed_sensor_more2.py::test_accumulate_energy_missing_power
  /Users/martinhorak/Downloads/oig_cloud/custom_components/oig_cloud/entities/computed_sensor.py:428: DeprecationWarning: datetime.datetime.utcnow() is deprecated and scheduled for removal in a future version. Use timezone-aware objects to represent datetimes in UTC: datetime.datetime.now(datetime.UTC).
    now = datetime.utcnow()

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
================================ tests coverage ================================
_______________ coverage: platform darwin, python 3.13.4-final-0 _______________

Name                                                                                     Stmts   Miss  Cover   Missing
----------------------------------------------------------------------------------------------------------------------
custom_components/oig_cloud/api/ha_rest_api.py                                             401     24    94%   250-252, 721, 765-766, 775-777, 854-855, 898, 914-917, 922, 941-947, 957-962, 979-981
custom_components/oig_cloud/battery_forecast/balancing/executor.py                         166     15    91%   131, 136, 153, 170-172, 195, 228-229, 247-251, 334
custom_components/oig_cloud/battery_forecast/balancing/plan.py                              56      5    91%   44, 49, 102, 113, 137
custom_components/oig_cloud/battery_forecast/config.py                                      74      4    95%   69, 125, 157-158
custom_components/oig_cloud/battery_forecast/data/adaptive_consumption.py                  365      1    99%   605
custom_components/oig_cloud/battery_forecast/data/input.py                                  82      8    90%   36-40, 61, 86, 171
custom_components/oig_cloud/battery_forecast/data/load_profiles.py                          35      6    83%   25, 34-35, 39-43
custom_components/oig_cloud/battery_forecast/data/solar_forecast.py                         50      3    94%   55-62, 93
custom_components/oig_cloud/battery_forecast/planning/charging_plan.py                     168     39    77%   77, 85, 125-129, 165-204, 209-224, 339, 342, 400, 406-412, 423, 426, 434, 453-481, 484
custom_components/oig_cloud/battery_forecast/planning/charging_plan_adjustments.py          92     23    75%   45-49, 76, 96, 104-109, 124-145, 148, 176, 178, 182, 187, 207, 213, 218-219
custom_components/oig_cloud/battery_forecast/planning/charging_plan_utils.py               129     10    92%   23, 35-36, 65, 84, 137, 202-203, 232, 266
custom_components/oig_cloud/battery_forecast/planning/forecast_update.py                   200     46    77%   123, 172, 212-242, 252-254, 257-261, 272-281, 299-300, 305-308, 340, 424-429, 446, 455, 490, 506, 511-512, 540-541, 555-556
custom_components/oig_cloud/battery_forecast/planning/interval_grouping.py                  84     20    76%   19, 26, 38, 51-61, 70-71, 74, 137-138, 145-146
custom_components/oig_cloud/battery_forecast/planning/mode_guard.py                        145     24    83%   27, 49, 51, 85, 90, 95, 98, 102, 118, 123, 129, 133, 160, 170, 175, 178, 237, 265, 275, 286, 298-300, 305, 308
custom_components/oig_cloud/battery_forecast/presentation/detail_tabs.py                    34      7    79%   47, 51-52, 56, 78-82
custom_components/oig_cloud/battery_forecast/presentation/detail_tabs_blocks.py            305      1    99%   307
custom_components/oig_cloud/battery_forecast/presentation/precompute.py                     49      6    88%   75-76, 86, 110-115
custom_components/oig_cloud/battery_forecast/presentation/state_attributes.py               49      1    98%   65
custom_components/oig_cloud/battery_forecast/presentation/unified_cost_tile.py              31      3    90%   53-55
custom_components/oig_cloud/battery_forecast/presentation/unified_cost_tile_helpers.py     407     55    86%   29, 42, 99, 119, 174, 213, 217, 250-251, 257-263, 287-289, 298-299, 315, 319, 334, 361, 363, 367, 371, 374, 405, 430-435, 452-455, 489, 513, 545-546, 642-643, 648-653, 659, 662, 772, 794-795, 813, 824, 828, 832, 844-846
custom_components/oig_cloud/battery_forecast/sensors/ha_sensor.py                          235     27    89%   138, 143, 552, 556, 560, 564, 568, 574, 580, 584, 590, 596, 600, 604, 608, 629, 636-637, 677, 680, 699-701, 711, 717, 738, 769
custom_components/oig_cloud/battery_forecast/sensors/sensor_runtime.py                      46     14    70%   39-44, 49, 60, 68-71, 76-77
custom_components/oig_cloud/battery_forecast/sensors/sensor_setup.py                        80      4    95%   43-44, 128, 150
custom_components/oig_cloud/battery_forecast/storage/plan_storage_baseline.py              136     37    73%   38, 46-47, 66-72, 83, 102-105, 125, 128-131, 140-141, 166-189, 244, 248-255, 262-263, 271-272, 281-304
custom_components/oig_cloud/battery_forecast/strategy/hybrid.py                            152     19    88%   87-89, 258, 262, 365, 375, 390, 409, 429, 455, 495, 553-572
custom_components/oig_cloud/battery_forecast/strategy/hybrid_planning.py                   185     21    89%   52-54, 58, 62, 103, 107, 200-202, 228-229, 232, 260, 281-284, 289-291
custom_components/oig_cloud/battery_forecast/strategy/hybrid_scoring.py                    160     48    70%   90-91, 93-94, 98-103, 134-183, 214, 217, 220-221, 226-229, 232, 234, 259, 265, 283
custom_components/oig_cloud/battery_forecast/task_utils.py                                  31      4    87%   17, 22-23, 32
custom_components/oig_cloud/battery_forecast/timeline/extended.py                          251     44    82%   40, 110-116, 126-158, 175-176, 199, 275-282, 292-293, 300-301, 319-322, 328-335, 351, 396-398, 411-414, 479, 541
custom_components/oig_cloud/battery_forecast/types.py                                      137     15    89%   366, 376-394, 413-418
custom_components/oig_cloud/battery_forecast/utils_common.py                                68     11    84%   24, 32, 43, 50-51, 57, 60-61, 68, 73-74
custom_components/oig_cloud/binary_sensor.py                                                75     20    73%   34-35, 42, 48, 52, 57, 62-64, 68, 72-86
custom_components/oig_cloud/boiler/api_views.py                                             66     11    83%   31, 35, 92-94, 114, 118, 125, 156-158
custom_components/oig_cloud/boiler/coordinator.py                                          169     65    62%   94-142, 146-150, 154-166, 188-189, 206-209, 266-272, 279-280, 298-299, 303, 315-339, 345, 349, 375-376
custom_components/oig_cloud/boiler/planner.py                                              103      7    93%   133, 153, 223, 229-232
custom_components/oig_cloud/boiler/profiler.py                                             106     15    86%   75-77, 99-100, 136-137, 154, 174, 179, 195, 230-231, 249, 253
custom_components/oig_cloud/boiler/sensors.py                                              181     33    82%   86-87, 105-106, 127-128, 146-147, 165-166, 184-185, 203-204, 222-231, 248, 277-281, 308, 314-318, 348, 356-360
custom_components/oig_cloud/config/schema.py                                                84     14    83%   127-129, 136, 147-149, 154, 158, 168-169, 174, 178, 181
custom_components/oig_cloud/config/steps.py                                                822     44    95%   833-834, 860, 869, 894, 899, 904, 1026, 1246, 1278, 1289, 1373, 1402, 1412, 1430, 1443, 1497, 1506-1507, 1521-1523, 1526-1528, 1545-1551, 1564, 1580, 1587, 1612, 1685, 1708, 1736, 2067, 2226, 2410-2413, 2438, 2496, 2519
custom_components/oig_cloud/config/validation.py                                            57      4    93%   44, 55-57
custom_components/oig_cloud/core/local_mapper.py                                           199     23    88%   17, 20-21, 35, 46-47, 52, 55, 71-72, 86, 102, 240, 258, 266-267, 273-274, 280, 295-296, 298, 307
custom_components/oig_cloud/core/oig_cloud_notification.py                                 575     84    85%   77, 124, 180-184, 192-193, 208-210, 234, 239-241, 249, 266-271, 282, 293-294, 311, 315, 332, 334, 350, 363, 365, 397-399, 503-505, 619-621, 631-632, 638, 655, 662-665, 700-701, 705-706, 723-725, 769-771, 806-807, 816, 834-836, 910-913, 934, 949-964, 968-969, 984-985, 990, 1011-1013
custom_components/oig_cloud/core/telemetry_store.py                                         59      9    85%   20, 49, 65, 70-72, 90-92
custom_components/oig_cloud/entities/adaptive_load_profiles_sensor.py                      549     79    86%   128, 130, 165-166, 234-235, 238-244, 249-250, 259, 305-307, 327, 354, 362-363, 400, 411-412, 417-419, 423, 427, 433-435, 442, 450-451, 471, 479-483, 492, 504, 531, 606, 611, 631, 648, 655, 662, 666, 674, 678, 684, 688, 692, 710, 772, 786-788, 825, 847-848, 898-905, 909-911, 917, 923-925, 969-972, 1155, 1160
custom_components/oig_cloud/entities/analytics_sensor.py                                   491     59    88%   53, 146-149, 378-381, 440-463, 467-468, 476, 490, 507-521, 530-535, 591, 622, 630, 678, 847-852, 874-875, 901-951, 987, 1006, 1011
custom_components/oig_cloud/entities/base_sensor.py                                         36      4    89%   32-34, 49
custom_components/oig_cloud/entities/battery_balancing_sensor.py                           203     38    81%   47-48, 88, 95-97, 104-105, 110-115, 120-121, 124-125, 128-129, 141-142, 167-168, 193-196, 200-203, 231-232, 273, 277-278, 282, 302-303, 312-313
custom_components/oig_cloud/entities/computed_sensor.py                                    438     58    87%   111, 113-114, 144, 184, 225-226, 231-253, 272-273, 280, 315, 330, 338, 345, 352, 361, 367, 371, 398, 408, 413-416, 458-459, 496-498, 532, 578-580, 584, 588, 593, 603-606, 613, 616-618, 621, 651, 703-705
custom_components/oig_cloud/entities/data_sensor.py                                        417     57    86%   97-98, 140, 163, 168, 173, 211, 219, 227, 231, 252, 277-281, 347, 353, 365, 369, 407-409, 415, 432, 442-444, 453, 457, 459, 482-492, 504-506, 534, 537, 541, 544, 548, 551, 564, 570, 576, 580, 588, 609, 624, 627, 629-630, 651, 672-675
custom_components/oig_cloud/entities/data_source_sensor.py                                  57      5    91%   49, 53, 87, 107-108
custom_components/oig_cloud/entities/sensor_runtime.py                                      75     20    73%   28, 42, 47, 91, 96, 111, 116, 121, 125-143, 147
custom_components/oig_cloud/entities/sensor_setup.py                                        73     12    84%   16, 36, 38-40, 43, 64-66, 68, 93-94
custom_components/oig_cloud/entities/shield_sensor.py                                      212     33    84%   22, 100, 139-145, 151-152, 158-159, 165-166, 196, 221-225, 277, 297, 362, 383-384, 396, 425-430, 434-436, 476-478
custom_components/oig_cloud/entities/solar_forecast_sensor.py                              459     83    82%   101, 137-144, 165-166, 171, 176, 225-232, 244-247, 282-285, 296, 306, 319, 328-331, 387, 419-427, 433-481, 521-540, 583-584, 698-700, 735, 761, 776-779, 785, 843, 856, 869, 921, 983-985
custom_components/oig_cloud/entities/statistics_sensor.py                                  573     99    83%   50-51, 76-77, 86-87, 106, 138, 142-172, 190, 242, 272-278, 377-381, 388, 404, 429-430, 435, 501-502, 519-520, 525, 562-567, 578, 582, 651, 669, 673, 681-682, 701-711, 810-811, 818, 827, 849, 893-894, 900-904, 918, 968-971, 982-986, 1001, 1010-1011, 1071-1075, 1124-1126, 1158, 1229-1232, 1236-1245, 1262-1264
custom_components/oig_cloud/lib/oig_cloud_client/models.py                                 210      2    99%   269, 282
custom_components/oig_cloud/physics.py                                                     103     12    88%   102, 119-128, 200
custom_components/oig_cloud/shield/core.py                                                 289     46    84%   159-162, 172-174, 193, 241-242, 260, 305-309, 313, 317, 333, 356, 377, 392-432, 519, 525, 545, 576, 593-594, 705, 722-723
custom_components/oig_cloud/shield/dispatch.py                                             227     35    85%   112, 147-162, 259-262, 274-282, 324-325, 335, 340, 366-367, 444-445, 538, 548, 554-559
custom_components/oig_cloud/shield/queue.py                                                214     38    82%   22-25, 33-36, 136, 138, 153-154, 219-229, 244, 249, 281-289, 338-344, 350-355, 357-363, 379-386, 543, 563
custom_components/oig_cloud/shield/validation.py                                           208     51    75%   49-50, 55-56, 74-75, 126, 128, 135-136, 139-143, 157-158, 172, 212-213, 229, 235-236, 246-247, 258-261, 281-282, 300-301, 309-314, 321, 347-348, 355, 357, 359-361, 365-366, 373-383
----------------------------------------------------------------------------------------------------------------------
TOTAL                                                                                    20904   1605    92%

84 files skipped due to complete coverage.
====================== 1889 passed, 5 warnings in 22.85s =======================
