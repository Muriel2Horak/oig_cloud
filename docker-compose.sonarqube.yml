services:
  sonarqube:
    image: sonarqube:lts-community
    container_name: oig_sonarqube
    restart: unless-stopped
    ports:
      # Use 9001 by default to avoid collisions with other local SonarQube instances.
      - "${SONAR_PORT:-9001}:9000"
    environment:
      # Local/dev convenience; avoids bootstrap checks in Docker Desktop.
      SONAR_ES_BOOTSTRAP_CHECKS_DISABLE: "true"
      # Stabilize JVM heaps to avoid random ES/Web/CE crashes on dev machines.
      SONAR_WEB_JAVAOPTS: "-Xms512m -Xmx768m"
      SONAR_CE_JAVAOPTS: "-Xms512m -Xmx768m"
      SONAR_ES_JAVAOPTS: "-Xms1g -Xmx1g"
      # Fallback for older env naming (some builds still read *_JAVA_OPTS)
      SONAR_WEB_JAVA_OPTS: "-Xms512m -Xmx768m"
      SONAR_CE_JAVA_OPTS: "-Xms512m -Xmx768m"
      SONAR_ES_JAVA_OPTS: "-Xms1g -Xmx1g"
    ulimits:
      nofile:
        soft: 65536
        hard: 65536
    volumes:
      - oig_sonarqube_data:/opt/sonarqube/data
      - oig_sonarqube_extensions:/opt/sonarqube/extensions
      - oig_sonarqube_logs:/opt/sonarqube/logs

volumes:
  oig_sonarqube_data:
  oig_sonarqube_extensions:
  oig_sonarqube_logs:
