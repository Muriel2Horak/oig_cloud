<!-- Tab: Bojler & Auto -->
<div id="boiler-tab" class="tab-content">

    <!-- Boiler Control Panel -->
    <div class="boiler-control-panel minimized" id="boiler-control-panel">
        <div class="panel-header" onclick="toggleBoilerControlPanel()">
            <h3>ÔøΩ Pokroƒçil√© ovl√°d√°n√≠ (Debug)
                <span class="info-bubble" onclick="event.stopPropagation()">‚ùì
                    <span class="info-bubble-tooltip">
                        <strong>‚ö†Ô∏è Automatick√Ω re≈æim</strong>
                        Bojler funguje plnƒõ automaticky! Syst√©m:
                        <ul>
                            <li>ü§ñ <strong>Automaticky pl√°nuje</strong> oh≈ôev ka≈æd√Ωch 5 minut</li>
                            <li>‚è∞ <strong>C√≠l:</strong> Do deadline (20:00) b√Ωt nah≈ô√°t√Ω na c√≠lovou teplotu</li>
                            <li>üí∞ <strong>Optimalizuje:</strong> Podle spotov√Ωch cen a profilu spot≈ôeby</li>
                        </ul>
                        <strong>Tlaƒç√≠tka n√≠≈æe jsou jen pro debug/override:</strong>
                        <ul>
                            <li><strong>Napl√°novat:</strong> Manu√°lnƒõ p≈ôepl√°novat (norm√°lnƒõ automatick√©)</li>
                            <li><strong>Aplikovat:</strong> Spustit pl√°n ruƒçnƒõ (norm√°lnƒõ automatick√©)</li>
                            <li><strong>Zru≈°it:</strong> Zru≈°it aktu√°ln√≠ pl√°n</li>
                        </ul>
                    </span>
                </span>
            </h3>
            <button class="btn-minimize" onclick="event.stopPropagation(); toggleBoilerControlPanel()">
                <span id="boiler-panel-toggle-icon">+</span>
            </button>
        </div>

        <div class="panel-content">
            <!-- Boiler Actions -->
            <div class="control-section">
                <h4>‚ö†Ô∏è Manu√°ln√≠ akce (override)</h4>
                <div class="button-group">
                    <button onclick="planBoilerHeating()" id="btn-plan-boiler"
                        title="[DEBUG] Manu√°lnƒõ p≈ôepl√°novat - norm√°lnƒõ se dƒõje automaticky ka≈æd√Ωch 5 min">
                        üìÖ P≈ôepl√°novat (debug)
                    </button>
                    <button onclick="applyBoilerPlan()" id="btn-apply-boiler"
                        title="[DEBUG] Spustit pl√°n ruƒçnƒõ - norm√°lnƒõ automatick√©">
                        ‚úÖ Aplikovat ruƒçnƒõ
                    </button>
                    <button onclick="cancelBoilerPlan()" id="btn-cancel-boiler"
                        title="Zru≈°it aktu√°ln√≠ automatick√Ω pl√°n topen√≠">
                        ‚ùå Zru≈°it pl√°n
                    </button>
                </div>
            </div>

            <!-- Boiler Status Info -->
            <div class="control-section">
                <h4>Stav bojleru</h4>
                <div class="boiler-status-grid">
                    <div class="status-card">
                        <div class="status-label">SOC</div>
                        <div class="status-value entity-value" id="boiler-soc-value"
                            data-entity="boiler_soc"
                            data-tooltip="State of Charge - √∫rove≈à nabit√≠ (0-100%)"
                            onclick="openEntityDialog(getSensorId('boiler_soc'))">
                            -- %
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">Teplota horn√≠</div>
                        <div class="status-value entity-value" id="boiler-temp-top-value"
                            data-entity="boiler_temperature_top"
                            data-tooltip="Teplota v horn√≠ z√≥nƒõ bojleru"
                            onclick="openEntityDialog(getSensorId('boiler_temperature_top'))">
                            -- ¬∞C
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">Energie pot≈ôebn√°</div>
                        <div class="status-value entity-value" id="boiler-energy-required-value"
                            data-entity="boiler_energy_required"
                            data-tooltip="Energie pot≈ôebn√° k dosa≈æen√≠ c√≠lov√© teploty"
                            onclick="openEntityDialog(getSensorId('boiler_energy_required'))">
                            -- kWh
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">N√°klady pl√°nu</div>
                        <div class="status-value entity-value" id="boiler-plan-cost-value"
                            data-entity="boiler_plan_cost"
                            data-tooltip="Celkov√© n√°klady na napl√°novan√Ω oh≈ôev"
                            onclick="openEntityDialog(getSensorId('boiler_plan_cost'))">
                            -- Kƒç
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Energy Breakdown -->
            <div class="control-section">
                <h4>Rozpad energie</h4>
                <div class="boiler-status-grid">
                    <div class="status-card">
                        <div class="status-label">Ze s√≠tƒõ</div>
                        <div class="status-value" id="boiler-grid-energy-value"
                            data-tooltip="Energie ze s√≠tƒõ (kWh + n√°klady)">
                            -- kWh (-- Kƒç)
                        </div>
                    </div>
                    <div class="status-card">
                        <div class="status-label">Alternativa</div>
                        <div class="status-value" id="boiler-alt-energy-value"
                            data-tooltip="Energie z alternativn√≠ho zdroje">
                            -- kWh (-- Kƒç)
                        </div>
                    </div>
                </div>
            </div>

            <!-- NEW: Predicted Usage -->
            <div class="control-section">
                <h4>Pl√°novan√© odbƒõry</h4>
                <div class="boiler-predicted-usage" id="boiler-predicted-usage">
                    <div class="usage-item">
                        <span class="usage-label">P≈ôedpokl√°dan√° spot≈ôeba:</span>
                        <span class="usage-value" id="boiler-predicted-today">-- kWh</span>
                    </div>
                    <div class="usage-item">
                        <span class="usage-label">P√≠ky spot≈ôeby:</span>
                        <span class="usage-value" id="boiler-peak-hours">--</span>
                    </div>
                    <div class="usage-item">
                        <span class="usage-label">‚âà objem vody (40¬∞C):</span>
                        <span class="usage-value" id="boiler-water-liters">-- L</span>
                    </div>
                </div>
            </div>

            <!-- NEW: Heating Ratio -->
            <div class="control-section">
                <h4>Pomƒõr doh≈ôevu</h4>
                <div class="heating-ratio-container">
                    <div class="ratio-bar">
                        <div class="ratio-grid" id="boiler-ratio-grid" style="width: 0%"
                            data-tooltip="Pod√≠l elekt≈ôiny ze s√≠tƒõ">
                        </div>
                        <div class="ratio-alt" id="boiler-ratio-alt" style="width: 0%"
                            data-tooltip="Pod√≠l alternativn√≠ho zdroje">
                        </div>
                    </div>
                    <div class="ratio-labels">
                        <span id="boiler-ratio-grid-label">0% s√≠≈•</span>
                        <span id="boiler-ratio-alt-label">0% alternativa</span>
                    </div>
                </div>
            </div>

            <!-- Boiler Plan Info -->
            <div class="control-section">
                <h4>Informace o pl√°nu</h4>
                <div class="boiler-plan-info" id="boiler-plan-info">
                    <div class="plan-info-row">
                        <span class="plan-info-label">Digest:</span>
                        <span class="plan-info-value" id="boiler-plan-digest">--</span>
                    </div>
                    <div class="plan-info-row">
                        <span class="plan-info-label">Slot≈Ø:</span>
                        <span class="plan-info-value" id="boiler-plan-slots">--</span>
                    </div>
                    <div class="plan-info-row">
                        <span class="plan-info-label">Topen√≠ aktivn√≠:</span>
                        <span class="plan-info-value" id="boiler-plan-active-slots">--</span>
                    </div>
                    <div class="plan-info-row">
                        <span class="plan-info-label">Od:</span>
                        <span class="plan-info-value" id="boiler-plan-start">--</span>
                    </div>
                    <div class="plan-info-row">
                        <span class="plan-info-label">Do:</span>
                        <span class="plan-info-value" id="boiler-plan-end">--</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- NEW: Boiler Visual Section (Grade Thermometer + Profiling Charts) -->
    <div class="boiler-visual-section">
        <div class="visual-grid">
            <!-- Grade Thermometer -->
            <div class="grade-thermometer-container">
                <h3>üå°Ô∏è Vizualizace bojleru</h3>
                <div class="boiler-tank">
                    <div class="temperature-scale">
                        <div class="scale-marker" style="top: 0%"><span>70¬∞C</span></div>
                        <div class="scale-marker" style="top: 16.67%"><span>60¬∞C</span></div>
                        <div class="scale-marker" style="top: 33.33%"><span>50¬∞C</span></div>
                        <div class="scale-marker" style="top: 50%"><span>40¬∞C</span></div>
                        <div class="scale-marker" style="top: 66.67%"><span>30¬∞C</span></div>
                        <div class="scale-marker" style="top: 83.33%"><span>20¬∞C</span></div>
                        <div class="scale-marker" style="top: 100%"><span>10¬∞C</span></div>
                    </div>
                    <div class="water-container">
                        <div class="water-level" id="boiler-water-level" style="height: 0%"></div>
                        <div class="target-line" id="boiler-target-line" style="bottom: 83.33%">
                            <span class="target-label">C√≠l</span>
                        </div>
                        <div class="sensor-marker sensor-top" id="boiler-sensor-top" style="bottom: 0%">
                            <span class="sensor-label">--¬∞C</span>
                        </div>
                        <div class="sensor-marker sensor-bottom" id="boiler-sensor-bottom" style="bottom: 0%">
                            <span class="sensor-label">--¬∞C</span>
                        </div>
                    </div>
                    <div class="grade-label" id="boiler-grade-label">0% nah≈ô√°to</div>
                </div>
            </div>

            <!-- Profiling Chart -->
            <div class="profiling-chart-container">
                <h3>üìä Profil spot≈ôeby (t√Ωden)</h3>
                <canvas id="boiler-profile-chart" style="max-height: 300px;"></canvas>
                <div class="profile-stats">
                    <div class="stat-item">
                        <span class="stat-label">Dnes:</span>
                        <span class="stat-value" id="profile-stat-today">-- kWh</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">P√≠ky:</span>
                        <span class="stat-value" id="profile-stat-peaks">--</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Sledov√°no:</span>
                        <span class="stat-value" id="profile-stat-days">7 dn√≠</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Heatmap -->
        <div class="heatmap-section">
            <h3>üóìÔ∏è Mapa spot≈ôeby (7 dn√≠)</h3>
            <div class="heatmap-container" id="boiler-heatmap">
                <!-- Bude generov√°no JavaScriptem -->
            </div>
            <div class="heatmap-legend">
                <span class="legend-item"><span class="legend-color low"></span> N√≠zk√°</span>
                <span class="legend-item"><span class="legend-color medium"></span> St≈ôedn√≠</span>
                <span class="legend-item"><span class="legend-color high"></span> Vysok√°</span>
            </div>
        </div>
    </div>

    <!-- Boiler Chart Section -->
    <div class="chart-section">
        <div class="chart-container">
            <canvas id="boiler-chart" style="max-height: 500px;"></canvas>
        </div>
    </div>

    <!-- Boiler Profile Section -->
    <div class="boiler-profile-section">
        <h3>‚öôÔ∏è Profil bojleru</h3>
        <div class="profile-grid">
            <div class="profile-card">
                <div class="profile-label">Objem</div>
                <div class="profile-value entity-value" id="boiler-profile-volume"
                    data-tooltip="Objem bojleru v litrech">
                    -- L
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-label">V√Ωkon topen√≠</div>
                <div class="profile-value entity-value" id="boiler-profile-heater-power"
                    data-tooltip="Jmenovit√Ω v√Ωkon topn√©ho tƒõlesa">
                    -- W
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-label">C√≠lov√° teplota</div>
                <div class="profile-value entity-value" id="boiler-profile-target-temp"
                    data-tooltip="C√≠lov√° teplota pro pl√°nov√°n√≠">
                    -- ¬∞C
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-label">Deadline</div>
                <div class="profile-value entity-value" id="boiler-profile-deadline"
                    data-tooltip="ƒåas do kter√©ho mus√≠ b√Ωt bojler nah≈ô√°t√Ω">
                    --:--
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-label">Stratifikace</div>
                <div class="profile-value entity-value" id="boiler-profile-stratification"
                    data-tooltip="Re≈æim modelov√°n√≠ stratifikace (simple_avg / two_zone)">
                    --
                </div>
            </div>
            <div class="profile-card">
                <div class="profile-label">Koeficient K</div>
                <div class="profile-value entity-value" id="boiler-profile-k-constant"
                    data-tooltip="Koeficient tepeln√© kapacity (kWh/K)">
                    --
                </div>
            </div>
        </div>
    </div>
</div>
